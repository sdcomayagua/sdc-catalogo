<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Soluciones Digitales Comayagua | Cat√°logo</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëæ</text></svg>">

  <meta property="og:title" content="Soluciones Digitales Comayagua | Cat√°logo Gamer 2026" />
  <meta property="og:description" content="Cat√°logo oficial de accesorios Gamer, PC y Streaming. Env√≠os a toda Honduras. ¬°Equ√≠pate con lo mejor!" />
  <meta property="og:image" content="https://raw.githubusercontent.com/sdcomayagua/sdc-catalogo/94d9f2b52faa08cccf5bfff9c50f2b8458ea4b04/PORTADA%20-%20SDC%20-%202026.png" />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0b1120" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    :root{
      --bg:#0b1120;
      --card-bg:#151e32;
      --primary:#38bdf8;
      --accent:#2dd4bf;
      --text:#f8fafc;
      --text-muted:#94a3b8;
      --border:#1e293b;
      --shadow-card:0 10px 26px rgba(0,0,0,.26);
      --chip-bg:rgba(30,41,59,.62);
      --chip-text:#cbd5e1;
      --bg-image:radial-gradient(at top,#1e293b 0%,#0b1120 100%);
      --danger:#ef4444;

      --promo-color:#ff6b00;
      --promo-glow:rgba(255,107,0,.55);
      --promo-bg:rgba(255,107,0,.14);

      /* ‚úÖ AGOTADO */
      --sold-bg: rgba(239,68,68,.10);
      --sold-border: rgba(239,68,68,.28);
      --sold-text: #ef4444;
      --sold-ribbon: rgba(239,68,68,.92);

      /* Pack est√©tico */
      --glass: rgba(21,30,50,.62);
      --glass-2: rgba(15,23,42,.55);
      --ring: rgba(56,189,248,.35);
      --soft: rgba(255,255,255,.06);
    }

    [data-theme="light"]{
      --bg:#f3f6fb;
      --card-bg:#ffffff;
      --primary:#0f172a;
      --accent:#15803d;
      --text:#1a1a1a;
      --text-muted:#64748b;
      --border:#e2e8f0;
      --shadow-card:0 12px 30px rgba(15,23,42,.10);
      --chip-bg:rgba(255,255,255,.70);
      --chip-text:#334155;
      --bg-image:none;

      --promo-color:#ea580c;
      --promo-glow:rgba(234,88,12,.18);
      --promo-bg:#fff7ed;

      --sold-bg: #fff1f2;
      --sold-border: #fecdd3;
      --sold-text: #e11d48;
      --sold-ribbon: #ef4444;

      --glass: rgba(255,255,255,.78);
      --glass-2: rgba(255,255,255,.62);
      --ring: rgba(14,165,233,.25);
      --soft: rgba(15,23,42,.03);
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}

    body{
      margin:0;
      font-family:'Outfit',sans-serif;
      background-color:var(--bg);
      background-image:var(--bg-image);
      background-attachment:fixed;
      color:var(--text);
      padding-bottom:92px;
      transition:background .3s,color .3s;
      -webkit-user-select:none;
      user-select:none;
      overflow-x:hidden;
    }
    /* ‚úÖ permitir copiar textos √∫tiles */
    .desc, .t-text, .faq-answer, footer, .status-row { -webkit-user-select:text; user-select:text; }

    /* ================== PACK EST√âTICO (NOISE + BLOBS) ================== */
    body::before{
      content:"";
      position:fixed;
      inset:-40px;
      pointer-events:none;
      z-index:-2;
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(56,189,248,.16), transparent 60%),
        radial-gradient(900px 500px at 85% 15%, rgba(45,212,191,.14), transparent 55%),
        radial-gradient(900px 520px at 50% 110%, rgba(129,140,248,.12), transparent 55%),
        repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0px, rgba(255,255,255,.02) 1px, transparent 1px, transparent 3px);
      filter: saturate(1.1);
      opacity:.95;
    }
    [data-theme="light"] body::before{
      background:
        radial-gradient(900px 500px at 18% 10%, rgba(14,165,233,.12), transparent 60%),
        radial-gradient(900px 500px at 85% 15%, rgba(5,150,105,.10), transparent 55%),
        radial-gradient(900px 520px at 50% 110%, rgba(79,70,229,.08), transparent 55%),
        repeating-linear-gradient(0deg, rgba(15,23,42,.02) 0px, rgba(15,23,42,.02) 1px, transparent 1px, transparent 4px);
      opacity:1;
    }

    /* ================== HEADER (GLASS) ================== */
    header{
      position:sticky;
      top:0;
      z-index:100;
      border-bottom:1px solid rgba(148,163,184,.18);
      padding:12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 14px 30px rgba(0,0,0,.16);
      background: var(--glass);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    [data-theme="light"] header{ border-bottom:1px solid rgba(15,23,42,.08); }

    .brand{display:flex;align-items:center;gap:10px;cursor:pointer}
    .brand img{height:40px;border-radius:10px;pointer-events:none}
    .brand h1{margin:0;font-size:16px;font-weight:900;color:var(--text);text-transform:uppercase;letter-spacing:1px}
    .brand h1 span{color:var(--primary)}
    .icon-btn{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(148,163,184,.22);
      color:var(--text);
      width:38px;height:38px;border-radius:14px;
      display:flex;align-items:center;justify-content:center;cursor:pointer;
      transition:.2s;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .icon-btn:hover{transform:translateY(-1px); box-shadow:0 10px 18px rgba(0,0,0,.14)}
    .icon-btn:active{transform:scale(.98)}
    .icon-btn:focus-visible{ outline:3px solid var(--ring); outline-offset:2px; }

    /* ================== HERO ================== */
    .hero-section{
      padding:20px 16px 8px;
      text-align:center;
      margin:10px auto 6px;
      max-width:980px;
    }
    .hero-shell{
      background: var(--glass-2);
      border:1px solid rgba(148,163,184,.18);
      border-radius:18px;
      padding:18px 14px;
      box-shadow:0 18px 40px rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .hero-shell{ border-color: rgba(15,23,42,.08); }

    .hero-title{font-size:26px;font-weight:900;margin:0 0 10px;line-height:1.1;color:var(--text);text-transform:uppercase}
    .hero-highlight{
      background:linear-gradient(-45deg,#38bdf8,#818cf8,#2dd4bf,#38bdf8);
      background-size:300%;
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      animation:textShine 10s ease-in-out infinite;
    }
    [data-theme="light"] .hero-highlight{
      background:linear-gradient(-45deg,#0284c7,#4f46e5,#059669,#0284c7);
      background-size:300%;
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent
    }
    @keyframes textShine{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .hero-desc{
      font-size:14px;
      color:var(--text-muted);
      margin:0 auto;
      line-height:1.5;
      max-width:520px;
      font-weight:600;
      opacity:.95;
    }

    /* ================== SEARCH ================== */
    .search-container{padding:0 16px;max-width:860px;margin:14px auto 8px}
    .search-box{position:relative;display:flex;align-items:center}
    .search-box i{position:absolute;left:14px;color:var(--text-muted)}
    .search-box input{
      width:100%;
      padding:14px 16px 14px 45px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,.22);
      background: var(--glass-2);
      color:var(--text);
      font-size:15px;
      outline:none;
      font-weight:800;
      box-shadow:0 12px 24px rgba(0,0,0,.10);
      user-select:text;
      -webkit-user-select:text;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .search-box input{
      border-color: rgba(15,23,42,.10);
      box-shadow:0 14px 30px rgba(15,23,42,.08);
    }
    .search-box input:focus{border-color:var(--primary); box-shadow:0 0 0 4px var(--ring), 0 14px 30px rgba(0,0,0,.10)}

    /* ================== TRUST ================== */
    .trust-grid{
      display:grid;grid-template-columns:repeat(2,1fr);gap:12px;
      padding:0 16px;max-width:860px;margin:14px auto 16px
    }
    .trust-item{
      display:flex;align-items:center;justify-content:center;gap:8px;
      font-size:11px;font-weight:900;color:var(--text-muted);
      background:var(--glass-2);
      padding:10px;border-radius:14px;
      border:1px solid rgba(148,163,184,.18);
      box-shadow:0 12px 24px rgba(0,0,0,.08);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .trust-item{border-color: rgba(15,23,42,.08); box-shadow:0 14px 30px rgba(15,23,42,.07)}
    .trust-item i{color:var(--accent);font-size:14px}

    /* ================== FILTERS (GLASS STICKY) ================== */
    .filters-wrapper{
      position:sticky;
      top:64px;
      z-index:90;
      padding:12px 0 10px;
      border-bottom:1px solid transparent;
      transition:.25s;
      background: transparent;
    }
    .filters-wrapper.scrolled{
      border-bottom:1px solid rgba(148,163,184,.18);
      box-shadow:0 14px 26px rgba(0,0,0,.12);
      background: var(--glass);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    [data-theme="light"] .filters-wrapper.scrolled{ border-bottom:1px solid rgba(15,23,42,.08); }

    .category-bar,.sub-bar{
      display:flex;gap:10px;overflow-x:auto;padding:0 16px 8px;scrollbar-width:none;
      position:relative;
      padding-right:44px;
    }
    .category-bar::-webkit-scrollbar,.sub-bar::-webkit-scrollbar{display:none}

    .category-bar::after,.sub-bar::after{
      content:"";
      position:absolute;
      top:0;right:0;
      width:44px;height:100%;
      pointer-events:none;
      background:linear-gradient(to right, transparent, rgba(0,0,0,0));
    }
    .filters-wrapper.scrolled .category-bar::after,
    .filters-wrapper.scrolled .sub-bar::after{
      background:linear-gradient(to right, transparent, rgba(0,0,0,0));
    }

    .chip{
      padding:8px 16px;
      border-radius:999px;
      background:var(--chip-bg);
      border:1px solid rgba(148,163,184,.22);
      color:var(--chip-text);
      font-size:13px;
      font-weight:900;
      white-space:nowrap;
      cursor:pointer;
      display:flex;align-items:center;gap:8px;
      text-transform:uppercase;
      transition:all .18s;
      box-shadow:0 10px 18px rgba(0,0,0,.08);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .chip{ box-shadow:0 14px 26px rgba(15,23,42,.06); border-color: rgba(15,23,42,.10); }

    .chip:hover{ transform: translateY(-1px); }
    .chip:active{ transform: scale(.98); }

    .chip.active{
      background: linear-gradient(135deg, rgba(56,189,248,.95), rgba(129,140,248,.95));
      color:#fff;
      border-color: rgba(56,189,248,.55);
      box-shadow:0 14px 24px rgba(56,189,248,.18);
    }
    [data-theme="dark"] .chip.active{ color:#000; font-weight:900; }
    [data-theme="light"] .chip.active{
      background: linear-gradient(135deg, rgba(14,165,233,.95), rgba(79,70,229,.95));
      border-color: rgba(14,165,233,.55);
      color:#fff;
    }

    .chip.promo-active{
      background:linear-gradient(135deg,#f59e0b,#d97706)!important;
      border-color:rgba(245,158,11,.65)!important;
      color:#fff!important;
      box-shadow:0 0 22px rgba(245,158,11,.45)!important;
    }

    .sub-bar .chip{
      padding:6px 12px;
      font-size:11px;
      border-radius:12px;
      background:transparent;
      border:1px solid rgba(148,163,184,.22)
    }
    .sub-bar .chip.active{
      background: var(--text);
      border-color: var(--text);
      color: var(--bg);
      box-shadow:none;
    }
    [data-theme="light"] .sub-bar .chip.active{
      background:#0ea5e9;border-color:#0ea5e9;color:#fff;
    }

    /* ================== STATUS ================== */
    .status-row{
      display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:center;
      padding:10px 16px 14px;
      max-width:1000px;margin:0 auto
    }
    .status-pill{
      background:var(--soft);
      border:1px solid rgba(148,163,184,.18);
      padding:8px 12px;border-radius:999px;
      font-size:12px;font-weight:900;color:var(--text-muted);
      text-transform:uppercase;letter-spacing:.4px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .status-pill{ background: rgba(255,255,255,.7); border-color: rgba(15,23,42,.08); }
    .status-pill strong{color:var(--text)}
    .status-pill.action{
      cursor:pointer;
      color:var(--primary);
      border-color: rgba(56,189,248,.30);
      background: rgba(56,189,248,.10);
    }
    [data-theme="light"] .status-pill.action{
      color:#0ea5e9;
      border-color: rgba(14,165,233,.30);
      background: rgba(14,165,233,.10);
    }
    .status-pill.action:active{transform:scale(.98)}

    /* ================== GRID / LOADER ================== */
    .grid{
      display:grid;grid-template-columns:1fr;gap:16px;padding:10px 16px;
      max-width:1200px;margin:0 auto;min-height:200px
    }
    @media(min-width:768px){.grid{grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:24px}}

    #loader{display:flex;flex-direction:column;align-items:center;justify-content:center;height:280px;color:var(--text)}
    .spinner{width:40px;height:40px;border:4px solid rgba(148,163,184,.24);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite;margin-bottom:18px}
    @keyframes spin{to{transform:rotate(360deg)}}

    .welcome-state{
      grid-column:1/-1;
      text-align:center;
      padding:34px 18px;
      color:var(--text-muted);
      background: var(--glass-2);
      border:1px solid rgba(148,163,184,.18);
      border-radius:18px;
      box-shadow:0 18px 36px rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .welcome-state{ border-color: rgba(15,23,42,.08); box-shadow:0 16px 34px rgba(15,23,42,.08) }
    .welcome-icon{font-size:50px;margin-bottom:14px;color:var(--primary);opacity:.9}
    .welcome-title{font-size:18px;font-weight:900;color:var(--text);margin-bottom:8px}
    .welcome-text{font-size:13px;max-width:520px;margin:0 auto;line-height:1.5;font-weight:700}

    .home-actions{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .home-btn{
      border:1px solid rgba(148,163,184,.20);
      background: rgba(255,255,255,.04);
      color:var(--text);
      border-radius:14px;
      padding:10px 14px;
      font-weight:900;
      cursor:pointer;
      text-transform:uppercase;
      letter-spacing:.4px;
      box-shadow:0 12px 24px rgba(0,0,0,.10);
      transition:.18s;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .home-btn{
      background: rgba(255,255,255,.72);
      border-color: rgba(15,23,42,.08);
      box-shadow:0 14px 30px rgba(15,23,42,.08);
    }
    .home-btn:hover{ transform:translateY(-2px); }
    .home-btn:active{ transform:scale(.98); }

    /* ================== CARD ================== */
    .card{
      background:var(--card-bg);
      border:1px solid rgba(148,163,184,.16);
      border-radius:18px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      position:relative;
      box-shadow:var(--shadow-card);
      transition:.18s;
      animation:fadeIn .25s ease-out forwards;
      will-change: transform;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
    .card:hover{
      transform: translateY(-3px);
      box-shadow: 0 18px 44px rgba(0,0,0,.20);
    }
    [data-theme="light"] .card:hover{ box-shadow: 0 18px 44px rgba(15,23,42,.14); }
    .card.promo-mode{border:2px solid var(--promo-color)!important;box-shadow:0 0 22px var(--promo-glow)!important}

    .card-img-container{
      position:relative;width:100%;
      aspect-ratio:1/1;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border-bottom:1px solid rgba(148,163,184,.14);
      overflow:hidden
    }
    [data-theme="light"] .card-img-container{
      background: linear-gradient(180deg, rgba(15,23,42,.02), rgba(15,23,42,.00));
      border-bottom:1px solid rgba(15,23,42,.08);
    }

    .card-img{position:absolute;inset:0;background-size:contain;background-position:center;background-repeat:no-repeat}
    .card.agotado .card-img{filter:grayscale(100%);opacity:.55}

    .share-prod{
      position:absolute;bottom:8px;left:8px;z-index:13;
      width:38px;height:38px;border-radius:14px;
      border:1px solid rgba(255,255,255,.22);
      background:rgba(0,0,0,.45);color:#fff;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;backdrop-filter:blur(6px);
      transition:.18s;
      padding:0; appearance:none; -webkit-appearance:none;
    }
    .share-prod:hover{transform:scale(1.06)}
    [data-theme="light"] .share-prod{background:rgba(15,23,42,.78)}
    .card.agotado .share-prod{opacity:.6}
    .share-prod:focus-visible{ outline:3px solid rgba(56,189,248,.65); outline-offset:2px; }

    .ribbon{
      position:absolute;top:16px;left:-34px;width:110px;background:var(--danger);color:#fff;font-size:10px;font-weight:900;
      padding:5px 0;transform:rotate(-45deg);text-align:center;z-index:10;box-shadow:0 2px 8px rgba(0,0,0,.35)
    }
    .ribbon-promo{
      position:absolute;top:0;right:0;background:linear-gradient(135deg,#f59e0b,#ea580c);color:#fff;font-size:10px;font-weight:900;
      padding:7px 12px;border-bottom-left-radius:12px;z-index:10;box-shadow:-2px 2px 10px rgba(245,158,11,.5);letter-spacing:1px
    }

    .video-badge{
      position:absolute;bottom:8px;right:8px;z-index:12;display:flex;align-items:center;gap:5px;padding:6px 12px;border-radius:999px;
      font-size:10px;font-weight:900;color:#fff;text-decoration:none;backdrop-filter:blur(6px);box-shadow:0 10px 20px rgba(0,0,0,.22);
      transition:.18s;text-transform:uppercase;border:1px solid rgba(255,255,255,.16)
    }
    .video-badge:hover{transform:scale(1.05)}
    .video-badge.tiktok{background:rgba(0,0,0,.92)}
    .video-badge.youtube{background:rgba(220,38,38,.95)}

    /* ‚úÖ BADGES: Compatible / Incluye / Quedan X */
    .img-badges{
      position:absolute;top:8px;left:8px;z-index:12;
      display:flex;flex-direction:column;gap:6px
    }
    .card-img-container.has-ribbon .img-badges{ top:44px; }

    .img-badge{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:14px;
      font-size:10px;font-weight:900;text-transform:uppercase;
      color:#fff;
      background:rgba(15,23,42,.65);
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)
    }
    .img-badge.compat{ background:rgba(2,132,199,.78); }
    .img-badge.incluye{ background:rgba(234,88,12,.72); }

    .stock-badge{
      position:absolute;top:8px;right:8px;z-index:12;
      padding:6px 10px;border-radius:999px;
      font-size:10px;font-weight:900;text-transform:uppercase;
      color:#fff;background:rgba(22,163,74,.82);
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)
    }
    .stock-badge.promo{ top:34px; }

    .card-body{padding:16px;display:flex;flex-direction:column;gap:8px;flex-grow:1}
    .card h3{
      margin:0;font-size:16px;font-weight:900;line-height:1.3;text-transform:uppercase;letter-spacing:.5px;overflow:hidden;
      display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;height:42px;color:var(--text)
    }
    .desc{font-size:13.5px;font-weight:600;color:var(--text);opacity:.92;margin:0;line-height:1.6;white-space:pre-line;padding-left:4px}

    .btn-gallery{
      display:flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:9px;margin-top:6px;background:transparent;
      border:1px dashed rgba(148,163,184,.26);border-radius:12px;color:var(--text-muted);font-size:11px;font-weight:900;text-decoration:none;
      text-transform:uppercase;letter-spacing:.5px;transition:.18s
    }
    .btn-gallery:hover{background:rgba(255,255,255,.04);border-color:var(--primary);color:var(--primary); transform: translateY(-1px);}

    .price-bar{
      display:flex;align-items:center;justify-content:center;gap:8px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(148,163,184,.18);
      border-radius:14px;padding:10px;margin-top:10px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .price-bar{background:#f0fdf4;border-color:#dcfce7}
    .price-stack{display:flex;flex-direction:column;align-items:center;text-align:center;line-height:1.15}
    .old-price-row{color:var(--text-muted);margin-bottom:4px;display:flex;gap:6px;align-items:center;justify-content:center;white-space:nowrap}
    .old-val{text-decoration:line-through;opacity:.7;font-size:12px}
    .current-price-row{font-size:22px;font-weight:900;color:var(--accent);white-space:nowrap}
    .price-icon{color:var(--accent);font-size:16px;opacity:.85}

    .btn-ws{
      background: linear-gradient(135deg, rgba(56,189,248,.95), rgba(129,140,248,.95));
      color:#fff;border:none;padding:12px;border-radius:14px;font-weight:900;font-size:13px;cursor:pointer;
      text-decoration:none;display:flex;align-items:center;justify-content:center;gap:6px;text-transform:uppercase;transition:.18s
    }
    .btn-ws:hover{ transform: translateY(-1px); box-shadow:0 14px 24px rgba(56,189,248,.18); }
    .btn-ws:active{ transform: scale(.98); }
    [data-theme="dark"] .btn-ws{color:#000}

    /* ‚úÖ CONSULTAR (AGOTADO): rojo suave */
    .btn-ws.btn-agotado{
      background: var(--sold-bg);
      border: 1px solid var(--sold-border);
      color: var(--sold-text);
      box-shadow:none;
    }
    .btn-ws.btn-agotado i{ color: var(--sold-text); }
    [data-theme="dark"] .btn-ws.btn-agotado{ color: var(--sold-text); }

    .promo-box{
      margin-top:10px;border:1px solid rgba(255,107,0,.35);background:var(--promo-bg);border-radius:16px;padding:12px;
      display:flex;flex-direction:column;gap:10px
    }
    .promo-top{
      background:rgba(255,255,255,.06);border:1px solid rgba(255,107,0,.35);border-radius:14px;padding:10px;display:flex;
      align-items:center;justify-content:center;flex-direction:column;gap:6px
    }
    .promo-total{font-size:26px;font-weight:900;color:var(--promo-color);display:flex;gap:10px;align-items:center}
    .promo-sub{font-size:12px;font-weight:900;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px}
    .qty-row{display:flex;align-items:center;justify-content:center;gap:10px}
    .qty-btn{
      width:44px;height:44px;border-radius:14px;border:1px solid rgba(148,163,184,.22);
      background:rgba(255,255,255,.06);color:var(--text);
      font-size:18px;font-weight:900;display:flex;align-items:center;justify-content:center;cursor:pointer;
      transition:.15s
    }
    .qty-btn:hover{transform:translateY(-1px)}
    .qty-btn.disabled{opacity:.45;cursor:not-allowed}
    .qty-pill{
      min-width:120px;text-align:center;padding:10px 12px;border-radius:14px;border:1px solid rgba(148,163,184,.18);
      background:rgba(255,255,255,.05);font-weight:900;text-transform:uppercase
    }
    .tier-grid{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
    .tier{
      padding:8px 10px;border-radius:999px;border:1px solid rgba(255,107,0,.35);background:rgba(255,255,255,.06);
      font-size:12px;font-weight:900;cursor:pointer;display:flex;gap:6px;align-items:center;text-transform:uppercase;
      transition:.15s
    }
    .tier:hover{transform:translateY(-1px)}
    .tier.active{background:rgba(255,107,0,.22);border-color:var(--promo-color);box-shadow:0 0 0 2px rgba(255,107,0,.18) inset}
    .tier.disabled{opacity:.35;cursor:not-allowed;position:relative}
    .tier.disabled::after{content:"‚úñ";position:absolute;right:8px;top:-6px;font-size:12px;color:var(--danger);font-weight:900}

    .hint{font-size:11px;font-weight:900;color:var(--text-muted);text-align:center;text-transform:uppercase;letter-spacing:.4px}

    .toast{
      position:fixed;left:50%;transform:translateX(-50%);bottom:96px;z-index:999;
      background:rgba(0,0,0,.85);color:#fff;padding:10px 12px;border-radius:14px;font-weight:900;font-size:12px;opacity:0;pointer-events:none;
      transition:.2s
    }
    [data-theme="light"] .toast{background:rgba(15,23,42,.92)}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}

    /* ================== TESTIMONIOS ================== */
    .testimonials-section{
      padding:28px 16px;margin-top:18px;
      background: var(--glass-2);
      border-top:1px solid rgba(148,163,184,.18);
      border-bottom:1px solid rgba(148,163,184,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .testimonials-section{border-color: rgba(15,23,42,.08)}
    .sec-title{text-align:center;font-size:18px;font-weight:900;margin:0 0 18px;color:var(--text);text-transform:uppercase}
    .testimonials-track{display:flex;gap:15px;overflow-x:auto;padding-bottom:10px;scrollbar-width:none}
    .testimonials-track::-webkit-scrollbar{display:none}
    .t-card{
      min-width:260px;max-width:260px;background:rgba(255,255,255,.04);
      border:1px solid rgba(148,163,184,.18);
      border-radius:16px;padding:15px;display:flex;flex-direction:column;gap:6px;
      box-shadow:0 18px 30px rgba(0,0,0,.12)
    }
    [data-theme="light"] .t-card{background:rgba(255,255,255,.80); border-color: rgba(15,23,42,.08); box-shadow:0 16px 28px rgba(15,23,42,.10)}
    .t-header{display:flex;align-items:center;gap:10px}
    .t-avatar{width:38px;height:38px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:14px}
    [data-theme="dark"] .t-avatar{color:#000}
    .t-info h4{margin:0;font-size:13px;color:var(--text)}
    .t-info span{font-size:10px;color:var(--accent);font-weight:900;text-transform:uppercase}
    .t-stars{color:#fbbf24;font-size:12px;margin:0}
    .t-text{margin:6px 0 0;font-size:12px;color:var(--text-muted);line-height:1.45;font-style:italic;text-align:justify}

    /* ================== LOCATION / FAQ / FOOTER ================== */
    .location-section{padding:20px 16px;margin-top:10px;text-align:center}
    .map-shell{
      width:100%;height:250px;
      border:1px solid rgba(148,163,184,.18);
      background: var(--glass-2);
      border-radius:18px;
      margin-bottom:12px;
      display:flex;align-items:center;justify-content:center;overflow:hidden;
      box-shadow:0 18px 36px rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .map-shell{ border-color: rgba(15,23,42,.08); box-shadow:0 16px 34px rgba(15,23,42,.08) }
    .map-btn{
      background:linear-gradient(135deg, rgba(56,189,248,.95), rgba(129,140,248,.95));
      border:none;color:#fff;padding:12px 16px;border-radius:14px;font-weight:900;text-transform:uppercase;cursor:pointer;
      display:flex;gap:8px;align-items:center;justify-content:center;
      transition:.18s
    }
    .map-btn:hover{transform:translateY(-1px); box-shadow:0 14px 24px rgba(56,189,248,.18)}
    [data-theme="dark"] .map-btn{color:#000}

    .location-btns{display:flex;gap:10px;justify-content:center}
    .btn-loc{
      flex:1;padding:12px;border-radius:14px;font-weight:900;font-size:12px;text-decoration:none;
      display:flex;align-items:center;justify-content:center;gap:8px;
      text-transform:uppercase;transition:.18s
    }
    .btn-loc:hover{transform:translateY(-1px)}
    .btn-google{background:#4285F4;color:#fff;box-shadow:0 12px 24px rgba(66,133,244,.22)}
    .btn-waze{background:#33ccff;color:#fff;box-shadow:0 12px 24px rgba(51,204,255,.22)}

    .faq-section{padding:20px 16px;max-width:860px;margin:0 auto}
    .faq-item{
      background: var(--glass-2);
      border:1px solid rgba(148,163,184,.18);
      border-radius:16px;
      margin-bottom:10px;
      overflow:hidden;
      box-shadow:0 16px 30px rgba(0,0,0,.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    [data-theme="light"] .faq-item{ border-color: rgba(15,23,42,.08); box-shadow:0 14px 28px rgba(15,23,42,.08) }
    .faq-question{padding:15px;font-size:14px;font-weight:900;color:var(--text);display:flex;justify-content:space-between;align-items:center;cursor:pointer}
    .faq-answer{padding:0 15px 15px;font-size:13px;color:var(--text-muted);line-height:1.5;display:none;text-align:justify;font-weight:600}
    .faq-item.open .faq-answer{display:block}
    .faq-item.open .faq-question i{transform:rotate(180deg)}

    footer{
      text-align:center;padding:30px 20px;color:var(--text-muted);font-size:12px;margin-top:20px;
      border-top:1px solid rgba(148,163,184,.18);
      background: transparent;
    }
    [data-theme="light"] footer{ border-top:1px solid rgba(15,23,42,.08); }
    .social-bar{display:flex;justify-content:center;gap:15px;margin-bottom:18px}
    .social-btn{
      width:42px;height:42px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:20px;color:#fff;text-decoration:none;
      transition:.18s;box-shadow:0 14px 26px rgba(0,0,0,.22); border:1px solid rgba(255,255,255,.10)
    }
    .social-btn:hover{transform:translateY(-2px)}
    .sb-insta{background:linear-gradient(45deg,#f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%)}
    .sb-fb{background:#1877F2}
    .sb-tiktok{background:#000;border:1px solid #333}

    /* ================== FLOATING BUTTONS ================== */
    .float-ws{
      position:fixed;bottom:20px;right:20px;width:56px;height:56px;background:#25D366;border-radius:18px;
      display:flex;align-items:center;justify-content:center;color:#fff;font-size:28px;
      box-shadow:0 18px 34px rgba(0,0,0,.28);z-index:200;text-decoration:none;
      border:1px solid rgba(255,255,255,.14);
      transition:.18s
    }
    .float-ws:hover{transform:translateY(-2px)}
    .highlight{outline:3px solid rgba(56,189,248,.65);box-shadow:0 0 0 6px rgba(56,189,248,.18);transition:.3s}

    /* ‚úÖ BOT√ìN SUBIR (NO MOLESTA) */
    .float-top{
      position:fixed;
      bottom:20px;
      left:20px;
      width:52px;
      height:52px;
      border-radius:16px;
      background:rgba(15,23,42,.72);
      color:#fff;
      border:1px solid rgba(255,255,255,.16);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      z-index:210;
      box-shadow:0 18px 34px rgba(0,0,0,.28);
      opacity:0;
      pointer-events:none;
      transform:translateY(10px);
      transition:.18s;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    [data-theme="light"] .float-top{ background:rgba(15,23,42,.82); }
    .float-top.show{
      opacity:1;
      pointer-events:auto;
      transform:translateY(0);
    }
    .float-top:focus-visible{ outline:3px solid rgba(56,189,248,.65); outline-offset:3px; }

    /* ‚úÖ AGOTADO: tarjeta + precio rojo + banda roja suave + cinta m√°s pro */
    .card.agotado{ border-color: var(--sold-border); }
    .card.agotado .price-bar{ background: var(--sold-bg); border-color: var(--sold-border); }
    .card.agotado .current-price-row,
    .card.agotado .price-icon{ color: var(--sold-text); }
    .card.agotado .ribbon{
      background: linear-gradient(135deg, var(--sold-ribbon), rgba(190,18,60,.96));
      box-shadow: 0 2px 10px rgba(239,68,68,.30);
    }

    /* ‚úÖ SOLO marca de agua diagonal (m√°s grande) ‚Äî sin ‚Äúbot√≥n‚Äù abajo */
    .card.agotado .card-img-container::before{
      content:"AGOTADO";
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: clamp(60px, 12vw, 96px);
      font-weight: 900;
      letter-spacing: 8px;
      transform: rotate(-18deg);
      color: rgba(239,68,68,.34);
      text-shadow: 0 10px 22px rgba(0,0,0,.18);
      z-index:9;
      pointer-events:none;
    }

    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important;scroll-behavior:auto!important}
    }
  </style>
</head>

<body>
  <header>
    <div class="brand" id="goHome" role="button" tabindex="0" aria-label="Ir al inicio">
      <img src="logo.png" alt="SDC" onerror="this.style.display='none'">
      <div>
        <h1>Soluciones <span>Digitales</span></h1>
        <small style="color:var(--text-muted); font-size:10px; letter-spacing:1px; font-weight:900;">COMAYAGUA</small>
      </div>
    </div>
    <div style="display:flex; gap:10px; align-items:center;">
      <div class="icon-btn" id="themeToggle" title="Tema" role="button" tabindex="0" aria-label="Cambiar tema">
        <i class="fa-solid fa-sun"></i>
      </div>
    </div>
  </header>

  <div class="hero-section">
    <div class="hero-shell">
      <h2 class="hero-title">üéÆ <span class="hero-highlight">Accesorios Gamer</span> & Tecnolog√≠a</h2>
      <p class="hero-desc">En Comayagua. Atenci√≥n directa por WhatsApp.<br>Productos probados y ofertas reales.</p>
    </div>
  </div>

  <div class="search-container">
    <div class="search-box">
      <i class="fa-solid fa-search"></i>
      <input id="searchInput" type="text" placeholder="Buscar producto (nombre o descripci√≥n)..." />
    </div>
  </div>

  <div class="trust-grid">
    <div class="trust-item"><i class="fa-solid fa-truck-fast"></i> Env√≠os a toda HN</div>
    <div class="trust-item"><i class="fa-solid fa-shield-halved"></i> Compra Segura</div>
    <div class="trust-item"><i class="fa-solid fa-headset"></i> Atenci√≥n Real</div>
    <div class="trust-item"><i class="fa-solid fa-box"></i> Contra Entrega (seg√∫n empresa)</div>
  </div>

  <div class="filters-wrapper" id="filtersWrapper">
    <div class="category-bar" id="categoryBar">
      <div class="chip active">Cargando...</div>
    </div>
    <div class="sub-bar" id="subBar"></div>
  </div>

  <div class="status-row" id="statusRow" style="display:none"></div>

  <div id="loader">
    <div class="spinner"></div>
    <p style="font-weight:900; letter-spacing:1px;">CARGANDO DATOS...</p>
  </div>

  <div class="grid" id="productGrid"></div>

  <div class="testimonials-section" id="testimonialsSection" style="display:none">
    <h3 class="sec-title">‚≠ê Lo que dicen los Gamers</h3>
    <div class="testimonials-track" id="testimonialsTrack"></div>
  </div>

  <div class="location-section">
    <h3 class="sec-title">üìç Base de Operaciones</h3>
    <div class="map-shell" id="mapShell">
      <button class="map-btn" id="loadMapBtn" aria-label="Cargar mapa">
        <i class="fa-solid fa-map"></i> Cargar mapa
      </button>
    </div>

    <div class="location-btns">
      <a href="https://www.google.com/maps/search/?api=1&query=Inkmortal+Tattoo+Comayagua"
         target="_blank" rel="noopener noreferrer"
         class="btn-loc btn-google">
        <i class="fa-solid fa-map-location-dot"></i> Google Maps
      </a>
      <a href="https://waze.com/ul?ll=14.454458,-87.6278246&navigate=yes"
         target="_blank" rel="noopener noreferrer"
         class="btn-loc btn-waze">
        <i class="fa-brands fa-waze"></i> Waze
      </a>
    </div>
  </div>

  <div class="faq-section">
    <h3 class="sec-title" style="margin-top:10px;">‚ùì Preguntas Frecuentes</h3>

    <div class="faq-item">
      <div class="faq-question" onclick="toggleFaq(this)">¬øHacen env√≠os a toda Honduras? <i class="fa-solid fa-chevron-down"></i></div>
      <div class="faq-answer">
        ¬°Claro! üöö Enviamos a todo Honduras con empresas como <b>C807, Forza y Cargo Expreso</b>. Tambi√©n pod√©s retirar o coordinar entrega en Comayagua.
      </div>
    </div>

    <div class="faq-item">
      <div class="faq-question" onclick="toggleFaq(this)">¬øQu√© m√©todos de pago aceptan? <i class="fa-solid fa-chevron-down"></i></div>
      <div class="faq-answer">
        Aceptamos <b>efectivo</b> y <b>transferencia</b>. Tambi√©n se puede coordinar <b>contra entrega</b> cuando aplica (el costo lo cobra la empresa al recibir).
      </div>
    </div>

    <div class="faq-item">
      <div class="faq-question" onclick="toggleFaq(this)">¬øC√≥mo puedo comprar? <i class="fa-solid fa-chevron-down"></i></div>
      <div class="faq-answer">
        Elige tu producto y toca <b>"PEDIR AHORA üöÄ"</b>. Te llevar√° a WhatsApp con el mensaje listo (cantidad, precio y total si es promo).
      </div>
    </div>
  </div>

  <footer>
    <div class="social-bar">
      <a href="https://www.facebook.com/sdcomayagua/" target="_blank" rel="noopener noreferrer" class="social-btn sb-fb" aria-label="Facebook">
        <i class="fa-brands fa-facebook-f"></i>
      </a>
      <a href="https://www.instagram.com/sdcomayagua/" target="_blank" rel="noopener noreferrer" class="social-btn sb-insta" aria-label="Instagram">
        <i class="fa-brands fa-instagram"></i>
      </a>
      <a href="https://www.tiktok.com/@gamer.comayagua" target="_blank" rel="noopener noreferrer" class="social-btn sb-tiktok" aria-label="TikTok">
        <i class="fa-brands fa-tiktok"></i>
      </a>
    </div>
    <p>¬© 2026 Soluciones Digitales Comayagua<br><span style="font-size:10px; opacity:0.6;">Todos los derechos reservados.</span></p>
  </footer>

  <a class="float-ws" href="https://wa.me/50432429490" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
    <i class="fa-brands fa-whatsapp"></i>
  </a>

  <!-- ‚úÖ BOT√ìN PARA SUBIR -->
  <button class="float-top" id="toTopBtn" type="button" aria-label="Subir al inicio">
    <i class="fa-solid fa-arrow-up"></i>
  </button>

  <div class="toast" id="toast"></div>

<script>
/* ================== CONFIG ================== */
/* ‚úÖ TU NUEVO SHEET ID */
const SHEET_ID="1p0PFCH-JWG9bQLeIh-6LgdMV7meHFa3KzIhNW9Xz3JE";

const MY_PHONE="50432429490";

/* ‚úÖ Config opcional (lista de pesta√±as a cargar) */
const CONFIG_SHEET_NAME="_config"; // si existe, aqu√≠ pones el nombre de las pesta√±as a cargar
const TESTIMONIOS_SHEET="testimonios";

/* ‚úÖ Fallback seguro (si no existe _config) */
const FALLBACK_SHEETS=["ofertas","gamer","pc","movil","streaming","cobertores","power"];

/* ================== STATE ================== */
let products=[];
let currentCategory="";
let currentSub="";
let soloOfertasMode=false;
let pendingPid="";
let dark=false;

/* ‚úÖ Persistencia */
const STATE_KEY="sdc_state_v1";

/* ================== HELPERS ================== */
function norm(s){
  return (s??"").toString().trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}
function money(n){
  const x=Number(n||0);
  return x.toLocaleString("es-HN",{maximumFractionDigits:0});
}
function toast(msg){
  const el=document.getElementById("toast");
  el.textContent=msg;
  el.classList.add("show");
  clearTimeout(window.__t);
  window.__t=setTimeout(()=>el.classList.remove("show"),1800);
}
function escapeHtml(s){
  return String(s ?? "").replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

/* ‚úÖ iconos: soporta nuevas categor√≠as autom√°ticamente */
function getIconForCategory(cat){
  const name=norm(cat);
  if(!name) return "üè†";
  if(name.includes("gamer") || name.includes("game")) return "üéÆ";
  if(name.includes("pc") || name.includes("comput")) return "üñ•Ô∏è";
  if(name.includes("movil")||name.includes("m√≥vil")||name.includes("cel")||name.includes("phone")) return "üì±";
  if(name.includes("stream")) return "üì∫";
  if(name.includes("cobert")||name.includes("funda")||name.includes("case")) return "üì¶";
  if(name.includes("power")||name.includes("carga")||name.includes("bateria")||name.includes("bater√≠a")) return "üîã";
  if(name.includes("audio")||name.includes("head")||name.includes("aur")) return "üéß";
  if(name.includes("cable")) return "üîå";
  if(name.includes("mouse")) return "üñ±Ô∏è";
  if(name.includes("tecl")) return "‚å®Ô∏è";
  return "üß©";
}
function pluralize(unidad,qty){
  const u=norm(unidad);
  if(u==="par") return qty===1?"par":"pares";
  if(u==="uno") return qty===1?"unidad":"unidades";
  return qty===1?"unidad":"unidades";
}

/* ‚úÖ (2) Badges helpers */
function cleanOneLine(s){
  return (s??"").toString().trim().replace(/\s+/g," ");
}
function buildImageBadges(p,{isPromoCard=false,isAgotado=false}={}){
  const parts=[];
  const comp = cleanOneLine(p.compatible);
  const inc  = cleanOneLine(p.incluye);

  if(comp) parts.push(`<div class="img-badge compat">‚úÖ ${escapeHtml(comp)}</div>`);
  if(inc)  parts.push(`<div class="img-badge incluye">üì¶ ${escapeHtml("Incluye: " + inc)}</div>`);

  const left = parts.length ? `<div class="img-badges">${parts.join("")}</div>` : "";

  const stock = Number(p.stock||0);
  const stockBadge = (!isAgotado && stock>0 && stock<=3)
    ? `<div class="stock-badge${isPromoCard?" promo":""}">Quedan ${stock}</div>`
    : "";

  return left + stockBadge;
}

/* ‚úÖ fetch con timeout: evita quedarse pegado */
async function fetchText(url, timeoutMs = 12000){
  const ctrl = new AbortController();
  const t = setTimeout(() => ctrl.abort(), timeoutMs);
  try{
    const res = await fetch(url, { signal: ctrl.signal, cache: "no-store" });
    return await res.text();
  } finally {
    clearTimeout(t);
  }
}

/* ‚úÖ guardar / cargar estado */
function saveState(){
  try{
    localStorage.setItem(STATE_KEY, JSON.stringify({
      dark, currentCategory, currentSub, soloOfertasMode
    }));
  }catch{}
}
function loadState(){
  try{
    return JSON.parse(localStorage.getItem(STATE_KEY) || "null");
  }catch{ return null; }
}
function applyTheme(isDark){
  dark=!!isDark;
  document.documentElement.setAttribute("data-theme", dark ? "dark" : "light");
  const toggle=document.getElementById("themeToggle");
  if(toggle){
    toggle.innerHTML = dark ? '<i class="fa-solid fa-moon"></i>' : '<i class="fa-solid fa-sun"></i>';
  }
}

/* ================== SHARE / COPY ================== */
function buildViewLink({cat="",sub="",offer=false}={}){
  const url=new URL(window.location);
  url.searchParams.delete("pid");
  if(cat) url.searchParams.set("cat",cat); else url.searchParams.delete("cat");
  if(sub) url.searchParams.set("sub",sub); else url.searchParams.delete("sub");
  if(offer) url.searchParams.set("offer","1"); else url.searchParams.delete("offer");
  return url.toString();
}
function buildProductLink(pid){
  const url=new URL(window.location);
  url.searchParams.set("pid", pid);
  url.searchParams.delete("cat");
  url.searchParams.delete("sub");
  url.searchParams.delete("offer");
  return url.toString();
}
async function copyText(text){
  try{
    if(navigator.clipboard && window.isSecureContext){
      await navigator.clipboard.writeText(text);
    }else{
      const ta=document.createElement("textarea");
      ta.value=text;
      ta.setAttribute("readonly","");
      ta.style.position="fixed";
      ta.style.left="-9999px";
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
    }
    toast("‚úÖ Link copiado");
  }catch(e){
    console.warn("No se pudo copiar:",e);
    toast("‚ö†Ô∏è No se pudo copiar");
  }
}
async function shareOrCopy(url){
  try{
    if(navigator.share){
      await navigator.share({ title: document.title, url });
      toast("‚úÖ Compartido");
      return;
    }
  }catch(e){}
  copyText(url);
}
function bindDoubleTap(el,fn){
  let last=0;
  el.addEventListener("touchend",(e)=>{
    const now=Date.now();
    if(now-last<320){
      e.preventDefault();
      fn();
    }
    last=now;
  },{passive:false});
  el.addEventListener("dblclick",(e)=>{
    e.preventDefault();
    fn();
  });
}
function copyCurrentView(){
  const link=buildViewLink({cat:currentCategory||"",sub:currentSub||"",offer:!!soloOfertasMode});
  shareOrCopy(link);
}

/* ================== URL ================== */
function updateUrl(){
  const url=new URL(window.location);
  if(currentCategory) url.searchParams.set("cat",currentCategory); else url.searchParams.delete("cat");
  if(currentSub) url.searchParams.set("sub",currentSub); else url.searchParams.delete("sub");
  if(soloOfertasMode) url.searchParams.set("offer","1"); else url.searchParams.delete("offer");
  if(pendingPid) url.searchParams.set("pid",pendingPid); else url.searchParams.delete("pid");
  window.history.replaceState({}, "", url);
}

/* URL manda; si no, usamos state guardado */
function loadFromUrlOrState(){
  const params=new URLSearchParams(window.location.search);
  const pid=params.get("pid");
  pendingPid=pid?pid:"";
  if(pendingPid){
    currentCategory="";
    currentSub="";
    soloOfertasMode=false;
    return;
  }

  const cat=params.get("cat");
  const sub=params.get("sub");
  const offer=params.get("offer");
  const hasAny = !!(cat || sub || offer);

  if(hasAny){
    soloOfertasMode=offer==="1";
    if(cat) currentCategory=norm(cat);
    if(sub) currentSub=sub;
    return;
  }

  const st=loadState();
  if(st){
    soloOfertasMode=!!st.soloOfertasMode;
    currentCategory=(st.currentCategory??"").toString();
    currentSub=(st.currentSub??"").toString();
    return;
  }

  /* ‚úÖ primer arranque: INICIO limpio (sin categor√≠a seleccionada) */
  currentCategory="";
  currentSub="";
  soloOfertasMode=false;
}

/* ================== SHEETS FETCH ================== */
function gvizUrlBySheet(sheetName){
  return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
}
function parseGviz(text){
  const start=text.indexOf("{");
  const end=text.lastIndexOf("}");
  const json=JSON.parse(text.slice(start, end+1));
  const cols=json.table.cols.map(c=>c&&c.label?norm(c.label):"col");
  const rows=json.table.rows.map(r=>{
    let obj={};
    r.c.forEach((c,i)=>obj[cols[i]]=c?(c.v===null?"":c.v):"");
    return obj;
  });
  return {cols,rows};
}

/* ‚úÖ Carga pesta√±as desde _config si existe (para que categor√≠as puedan crecer) */
async function fetchConfigSheets(){
  try{
    const t = await fetchText(gvizUrlBySheet(CONFIG_SHEET_NAME));
    const {rows}=parseGviz(t);

    const namesRaw = rows.map(r=>{
      const v =
        r.sheet ?? r.pestana ?? r.pesta√±a ?? r.hoja ?? r.tab ?? r.nombre ?? r.name ?? r.col ??
        Object.values(r).find(x => (x ?? "").toString().trim()) ?? "";
      return (v ?? "").toString().trim();
    }).filter(Boolean);

    const uniq = [];
    const seen = new Set();
    for(const n of namesRaw){
      const nn = norm(n);
      if(!nn) continue;
      if(nn === CONFIG_SHEET_NAME || nn === TESTIMONIOS_SHEET) continue;
      if(!seen.has(nn)){ seen.add(nn); uniq.push(n); }
    }

    /* si config existe pero est√° vac√≠a, usamos fallback */
    if(!uniq.length) return FALLBACK_SHEETS.slice();
    return uniq;
  }catch(e){
    console.warn("Config fall√≥, usando fallback",e);
    return FALLBACK_SHEETS.slice();
  }
}

async function fetchTab(sheetName){
  try{
    const sheetNorm = norm(sheetName);
    const t = await fetchText(gvizUrlBySheet(sheetName));
    const {rows}=parseGviz(t);

    return rows.map(o=>{
      const obj={...o};
      obj._sheet=sheetNorm;

      /* ‚úÖ categoria din√°mica:
         - si la pesta√±a NO es ofertas: categor√≠a = nombre de la pesta√±a
         - si es ofertas: respetamos "categoria" en la fila (para clasificar ofertas por categor√≠a)
      */
      const cellCat = norm(obj.categoria || "");
      if(sheetNorm !== "ofertas" && sheetNorm !== CONFIG_SHEET_NAME && sheetNorm !== TESTIMONIOS_SHEET){
        obj.categoria = sheetNorm;
      }else{
        obj.categoria = cellCat || "gamer";
      }

      obj.subcategoria=(obj.subcategoria??"").toString().trim();
      obj.nombre=(obj.nombre??"").toString().trim();
      obj.descripcion=(obj.descripcion??obj.descipcion??"").toString();
      obj.estado=norm(obj.estado||"activo");
      obj.stock=Number(obj.stock||0);
      obj.precio=Number(obj.precio||0);
      obj.precio_anterior=Number(obj.precio_anterior||0);
      obj.unidad=(obj.unidad??"").toString().trim()||"unidad";
      obj.id=(obj.id??"").toString().trim();
      obj.solo_ofertas=norm(obj.solo_ofertas||"");

      /* ‚úÖ ofertas: por pesta√±a OFERTAS o por solo_ofertas = si */
      obj._isOffer=(obj._sheet==="ofertas")||["si","s√≠","1","true","yes"].includes(obj.solo_ofertas);

      if(obj.imagen && obj.imagen.includes("github.com") && obj.imagen.includes("/blob/")){
        obj.imagen=obj.imagen.replace("github.com","raw.githubusercontent.com").replace("/blob/","/");
      }
      return obj;
    }).filter(p=>{
      if(!p || !p.nombre) return false;
      if(p.estado==="inactivo" || p.estado==="0") return false;

      /* ‚úÖ ignora separadores grandes tipo "COOLERS / DEDALES / GAMEPAD" */
      const isSeparator =
        (p.nombre === p.nombre.toUpperCase()) &&
        Number(p.precio||0) <= 0 &&
        Number(p.stock||0) <= 0 &&
        !p.imagen && !p.galeria &&
        !p.descripcion &&
        !p.whatsapp && !p.tiktok && !p.youtube &&
        !p.id;

      return !isSeparator;
    });
  }catch(e){
    console.warn("Tab fall√≥:",sheetName,e);
    return [];
  }
}

/* ‚úÖ util: categor√≠as din√°micas desde productos */
function getCategoryList(){
  const set = new Set();
  products.forEach(p=>{
    const c = norm(p.categoria || "");
    if(c) set.add(c);
  });

  const preferred = ["gamer","pc","movil","streaming","cobertores","power"];
  const all = [...set];

  const first = preferred.filter(x => all.includes(x));
  const rest = all.filter(x => !preferred.includes(x)).sort((a,b)=>a.localeCompare(b,"es"));

  return [...first, ...rest];
}

/* ‚úÖ loadAll a prueba de fallos */
async function loadAll(){
  loadFromUrlOrState();

  try{
    const sheetNames=await fetchConfigSheets();
    const results=await Promise.all(sheetNames.map(n=>fetchTab(n)));
    products=results.flat();

    /* mapa por ID */
    window.productById=new Map(products.map(p=>[p.id,p]));

    if(pendingPid){
      const found=productById.get(pendingPid);
      if(found){
        currentCategory=found.categoria||"";
        soloOfertasMode=!!found._isOffer;
        currentSub=(found.subcategoria||"").trim();
        const si=document.getElementById("searchInput");
        if(si) si.value="";
      }else{
        toast("‚ö†Ô∏è Producto no encontrado");
      }
    }

    document.getElementById("loader").style.display="none";
    initCategoryBar();
    updateSubs();
    render();
    await loadTestimonials();
    if(pendingPid){setTimeout(()=>focusProductById(pendingPid),120);}

    saveState();
  }catch(e){
    console.error("‚ùå Error en loadAll:", e);
    toast("‚ö†Ô∏è No se pudo cargar el cat√°logo (revisa permisos del Sheets)");
  }finally{
    const loader=document.getElementById("loader");
    if(loader) loader.style.display="none";
  }
}

/* ================== CATEGORY UI ================== */
function initCategoryBar(){
  const bar=document.getElementById("categoryBar");
  bar.innerHTML="";

  /* ‚úÖ INICIO (limpia filtros) */
  const homeChip=document.createElement("div");
  homeChip.className="chip"+(!currentCategory && !soloOfertasMode ? " active" : "");
  homeChip.textContent="üè† INICIO";
  homeChip.onclick=()=>{
    currentCategory="";
    currentSub="";
    pendingPid="";
    // no tocamos soloOfertasMode aqu√≠; lo apagamos para que sea inicio real
    soloOfertasMode=false;
    updateUrl();
    initCategoryBar();
    updateSubs();
    render();
    saveState();
    window.scrollTo({top:0,behavior:"smooth"});
  };
  bindDoubleTap(homeChip, ()=>{
    copyText(buildViewLink({cat:"",sub:"",offer:false}));
  });
  bar.appendChild(homeChip);

  /* ‚úÖ OFERTAS (modo) */
  const offerChip=document.createElement("div");
  offerChip.className="chip"+(soloOfertasMode?" active promo-active":"");
  offerChip.textContent="üî• OFERTAS";
  offerChip.onclick=()=>{
    soloOfertasMode=!soloOfertasMode;
    updateUrl();
    initCategoryBar();
    updateSubs();
    render();
    saveState();
  };
  bar.appendChild(offerChip);

  /* ‚úÖ Categor√≠as din√°micas (pueden aumentar desde Sheets) */
  const cats = getCategoryList();
  cats.forEach(cat=>{
    const btn=document.createElement("div");
    btn.className="chip"+(cat===currentCategory?" active":"");
    btn.textContent=`${getIconForCategory(cat)} ${cat.toUpperCase()}`;
    btn.onclick=()=>{
      currentCategory=cat;
      currentSub="";
      pendingPid="";
      updateUrl();
      initCategoryBar();
      updateSubs();
      render();
      saveState();
      window.scrollTo({top:0,behavior:"smooth"});
    };

    bindDoubleTap(btn, ()=>{
      copyText(buildViewLink({cat,sub:"",offer:!!soloOfertasMode}));
    });

    bar.appendChild(btn);
  });
}

function updateSubs(){
  const bar=document.getElementById("subBar");
  bar.innerHTML="";

  if(!currentCategory){bar.style.display="none";return;}

  const base=products.filter(p=>norm(p.categoria)===currentCategory);
  const inMode=base.filter(p=>soloOfertasMode ? p._isOffer : !p._isOffer);
  const subs=[...new Set(inMode.map(p=>(p.subcategoria||"").trim()).filter(Boolean))];

  if(currentSub && !subs.includes(currentSub)) currentSub="";

  if(!subs.length){bar.style.display="none";return;}
  bar.style.display="flex";

  const allBtn=document.createElement("div");
  allBtn.className="chip"+(!currentSub?" active":"");
  allBtn.textContent="Todo";
  allBtn.onclick=()=>{
    currentSub="";
    pendingPid="";
    updateUrl();
    render();
    setActiveSub(allBtn);
    saveState();
  };
  bindDoubleTap(allBtn, ()=>{
    copyText(buildViewLink({cat:currentCategory||"",sub:"",offer:!!soloOfertasMode}));
  });
  bar.appendChild(allBtn);

  subs.sort((a,b)=>a.localeCompare(b,"es")).forEach(s=>{
    const b=document.createElement("div");
    b.className="chip"+(currentSub===s?" active":"");
    b.textContent=s;
    b.onclick=()=>{
      currentSub=s;
      pendingPid="";
      updateUrl();
      render();
      setActiveSub(b);
      saveState();
    };

    bindDoubleTap(b, ()=>{
      copyText(buildViewLink({cat:currentCategory||"",sub:s,offer:!!soloOfertasMode}));
    });

    bar.appendChild(b);
  });
}
function setActiveSub(btn){
  document.querySelectorAll(".sub-bar .chip").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

/* ================== PROMOS ================== */
function extractPromos(p){
  const promos=[];
  for(const k in p){
    const m=k.match(/^promo(\d+)_cant$/i);
    if(m){
      const idx=m[1];
      const cant=Number(p[k]||0);
      const precio=Number(p[`promo${idx}_precio`]||0);
      if(cant>0 && precio>0) promos.push({cant,precio});
    }
  }
  promos.sort((a,b)=>a.cant-b.cant);
  const map=new Map();
  promos.forEach(x=>{
    if(!map.has(x.cant)) map.set(x.cant,x.precio);
    else map.set(x.cant,Math.min(map.get(x.cant),x.precio));
  });
  return [...map.entries()].map(([cant,precio])=>({cant,precio})).sort((a,b)=>a.cant-b.cant);
}
function priceForQty(p,qty){
  const base=Number(p.precio||0);
  const promos=extractPromos(p);
  let unit=base;
  let tier={cant:1,precio:base};
  promos.forEach(pr=>{
    if(qty>=pr.cant){unit=pr.precio;tier={cant:pr.cant,precio:pr.precio};}
  });
  return {unitPrice:unit,tier,promos};
}

/* ================== RENDER ================== */
function buildStatus(count){
  const row=document.getElementById("statusRow");
  const q=document.getElementById("searchInput").value.trim();

  row.style.display="flex";
  row.innerHTML=`
    <div class="status-pill">Mostrando: <strong>${count}</strong></div>
    <div class="status-pill">Categor√≠a: <strong>${currentCategory?escapeHtml(currentCategory.toUpperCase()):"TODAS"}</strong></div>
    ${currentSub?`<div class="status-pill">Sub: <strong>${escapeHtml(currentSub)}</strong></div>`:``}
    ${soloOfertasMode?`<div class="status-pill">Ofertas ‚úÖ</div>`:``}
    ${(currentCategory || currentSub || soloOfertasMode || q)?`<div class="status-pill action" id="shareViewBtn"><i class="fa-solid fa-link"></i> Compartir</div>`:``}
  `;
  const shareBtn=document.getElementById("shareViewBtn");
  if(shareBtn) shareBtn.onclick=copyCurrentView;
}

function render(){
  const grid=document.getElementById("productGrid");
  grid.innerHTML="";

  const q=norm(document.getElementById("searchInput").value);

  /* ‚úÖ INICIO limpio: sin categor√≠a + sin ofertas + sin b√∫squeda */
  if(!currentCategory && !soloOfertasMode && !q){
    const row=document.getElementById("statusRow");
    row.style.display="none";

    const cats = getCategoryList().slice(0, 10); // botones del home (hasta 10)
    const buttons = cats.map(c=>{
      const ic = getIconForCategory(c);
      return `<button class="home-btn" data-cat="${escapeHtml(c)}">${ic} ${escapeHtml(c.toUpperCase())}</button>`;
    }).join("");

    grid.innerHTML=`
      <div class="welcome-state">
        <div class="welcome-icon">üëæ</div>
        <div class="welcome-title">Bienvenido a SDC</div>
        <div class="welcome-text">
          Toca una categor√≠a o usa la b√∫squeda para ver productos.
        </div>
        <div class="home-actions">
          ${buttons}
        </div>
      </div>
    `;

    grid.querySelectorAll("[data-cat]").forEach(btn=>{
      btn.onclick=()=>{
        currentCategory=norm(btn.dataset.cat);
        currentSub="";
        pendingPid="";
        updateUrl();
        initCategoryBar();
        updateSubs();
        render();
        saveState();
        window.scrollTo({top:0,behavior:"smooth"});
      };
    });
    return;
  }

  let list=products.slice();

  /* filtro categor√≠a (si hay) */
  if(currentCategory) list=list.filter(p=>norm(p.categoria)===currentCategory);
  if(currentSub) list=list.filter(p=>(p.subcategoria||"").trim()===currentSub);

  /* modo ofertas */
  list=list.filter(p=>soloOfertasMode ? p._isOffer : !p._isOffer);

  /* b√∫squeda */
  if(q){
    list=list.filter(p=>norm(p.nombre).includes(q) || norm(p.descripcion).includes(q) || norm(p.subcategoria).includes(q) || norm(p.categoria).includes(q));
  }

  /* ‚úÖ Disponibles primero */
  list.sort((a,b)=>{
    const aOut = Number(a.stock||0) <= 0;
    const bOut = Number(b.stock||0) <= 0;
    if(aOut !== bOut) return aOut - bOut;
    return norm(a.nombre).localeCompare(norm(b.nombre), "es");
  });

  buildStatus(list.length);

  if(list.length===0){
    grid.innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--text-muted)">
      <i class="fa-solid fa-ghost" style="font-size:40px;margin-bottom:10px;"></i>
      <p style="font-weight:900;letter-spacing:1px;">NO HAY RESULTADOS</p>
      <p style="font-size:12px;max-width:520px;margin:10px auto 0;line-height:1.5;font-weight:700;">
        Tip: si activaste <b>üî• OFERTAS</b>, desact√≠valo para ver el cat√°logo normal.
      </p>
    </div>`;
    return;
  }

  list.forEach(p=>{
    const isAgotado=Number(p.stock||0)<=0;
    const promos=extractPromos(p);

    /* ‚úÖ si est√° AGOTADO, NO mostramos widget promo */
    const isPromoCard = p._isOffer && promos.length && !isAgotado;
    const hasRibbon = isAgotado || isPromoCard;

    const card=document.createElement("div");
    card.className=`card ${isAgotado?"agotado":""} ${isPromoCard?"promo-mode":""}`;
    card.dataset.pid=p.id||"";

    const imgUrl=(p.imagen||"");
    const ribbon=isAgotado?`<div class="ribbon">AGOTADO</div>`:(isPromoCard?`<div class="ribbon-promo">üî• HOT SALE</div>`:``);

    let videoBadge="";
    if(p.tiktok) videoBadge=`<a href="${p.tiktok}" target="_blank" rel="noopener noreferrer" class="video-badge tiktok"><i class="fa-brands fa-tiktok"></i> VER VIDEO</a>`;
    else if(p.youtube) videoBadge=`<a href="${p.youtube}" target="_blank" rel="noopener noreferrer" class="video-badge youtube"><i class="fa-brands fa-youtube"></i> VER VIDEO</a>`;

    let galleryBtn="";
    if(p.galeria) galleryBtn=`<a href="${p.galeria}" target="_blank" rel="noopener noreferrer" class="btn-gallery"><i class="fa-regular fa-images"></i> Ver M√°s Fotos</a>`;

    let rawDesc=(p.descripcion||"");
    let descText=rawDesc.replace(/(\r\n|\n|\r)/gm," ").replace(/([‚ñ∫‚Ä¢\-‚òÖ])/g,"\n$1").trim();

    const safeName=escapeHtml(p.nombre);
    const safeDesc=escapeHtml(descText);

    const showOld=Number(p.precio_anterior||0)>Number(p.precio||0) && !isPromoCard;
    const priceHTML=`
      <div class="price-bar">
        <i class="fa-solid fa-tag price-icon"></i>
        <div class="price-stack">
          ${showOld?`<div class="old-price-row"><span style="font-weight:900;">Antes:</span><span class="old-val">Lps. ${money(p.precio_anterior)}</span></div>`:``}
          <div class="current-price-row">Lps. ${money(p.precio||0)}</div>
        </div>
      </div>`;

    const normalMsg=(p.whatsapp && p.whatsapp.toString().trim().length>5)
      ? p.whatsapp
      : `Hola SDC, me interesa: *${p.nombre}*\nPrecio: Lps. ${money(p.precio||0)}\nQuedo atento(a). Gracias.`;
    const normalLink=`https://wa.me/${MY_PHONE}?text=${encodeURIComponent(normalMsg)}`;

    let promoHTML="";
    let btnText=isAgotado?"CONSULTAR":"PEDIR AHORA üöÄ";

    if(isPromoCard){
      let defaultQty=1;
      const stock=Number(p.stock||0);
      if(promos.some(x=>x.cant===2) && stock>=2) defaultQty=2;

      promoHTML=`
        <div class="promo-box" data-pid="${p.id}" data-qty="${defaultQty}">
          <div class="promo-top">
            <div class="promo-total"><i class="fa-solid fa-tag"></i> <span class="promoTotal">Lps. 0</span></div>
            <div class="promo-sub"><span class="promoLine">-</span></div>
          </div>

          <div class="qty-row">
            <button class="qty-btn minus" type="button" aria-label="Disminuir">‚àí</button>
            <div class="qty-pill"><span class="qtyVal">${defaultQty}</span> <span class="qtyUnit">UNIDADES</span></div>
            <button class="qty-btn plus" type="button" aria-label="Aumentar">+</button>
          </div>

          <div class="tier-grid"></div>
          <div class="hint">El total y WhatsApp se actualizan solos ‚úÖ</div>

          <a href="#" target="_blank" rel="noopener noreferrer" class="btn-ws promoBtn"><i class="fa-brands fa-whatsapp"></i> PEDIR</a>
        </div>`;
      btnText="PEDIR";
    }

    /* ‚úÖ Badges autom√°ticos (compatible / incluye / quedan X) */
    const badgesHTML = buildImageBadges(p,{isPromoCard,isAgotado});

    card.innerHTML=`
      <div class="card-img-container ${hasRibbon?'has-ribbon':''}">
        <div class="card-img" style="background-image:url('${imgUrl}')"></div>
        ${ribbon}
        ${videoBadge}
        ${badgesHTML}
        ${p.id ? `<button class="share-prod" type="button" aria-label="Compartir producto"><i class="fa-solid fa-share-nodes"></i></button>` : ``}
      </div>
      <div class="card-body">
        <h3>${safeName}</h3>
        <div class="desc">${safeDesc}</div>
        ${galleryBtn}
        ${isPromoCard?promoHTML:priceHTML}
        ${!isPromoCard?`<a href="${normalLink}" target="_blank" rel="noopener noreferrer" class="btn-ws ${isAgotado?'btn-agotado':''}">
          <i class="fa-brands fa-whatsapp"></i> ${btnText}
        </a>`:``}
      </div>
    `;

    grid.appendChild(card);

    const shareBtn=card.querySelector(".share-prod");
    if(shareBtn && p.id){
      shareBtn.onclick=()=>shareOrCopy(buildProductLink(p.id));
    }

    if(isPromoCard) initPromoWidget(card,p);
  });
}

function initPromoWidget(card,p){
  const box=card.querySelector(".promo-box");
  if(!box) return;

  let qty=Number(box.dataset.qty||1);
  const stock=Number(p.stock||0);
  const unidad=p.unidad||"unidad";
  const promos=extractPromos(p);

  const tierSet=new Set([1,2,3,4]);
  promos.forEach(x=>tierSet.add(x.cant));
  const tiers=[...tierSet].sort((a,b)=>a-b);

  const tierGrid=box.querySelector(".tier-grid");
  tierGrid.innerHTML="";

  tiers.forEach(cant=>{
    const {unitPrice}=priceForQty(p,cant);
    const t=document.createElement("div");
    t.className="tier";
    t.dataset.cant=cant;
    const label=cant>=5?`${cant}+`:`${cant}`;
    t.innerHTML=`<span>${label}</span> <span style="opacity:.8;">Lps.${money(unitPrice)}</span>`;
    const disabled=stock>0 && cant>stock;
    if(disabled) t.classList.add("disabled");
    t.onclick=()=>{
      if(disabled){toast(`Solo hay ${stock} disponibles`);return;}
      qty=cant;
      updatePromoUI();
    };
    tierGrid.appendChild(t);
  });

  const minus=box.querySelector(".minus");
  const plus=box.querySelector(".plus");

  minus.onclick=()=>{qty=Math.max(1,qty-1);updatePromoUI();};
  plus.onclick=()=>{
    if(stock>0 && qty>=stock){
      toast(`Solo hay ${stock} disponibles`);
      qty=stock;updatePromoUI();return;
    }
    qty=qty+1;updatePromoUI();
  };

  function updatePromoUI(){
    if(stock>0 && qty>stock){
      qty=stock;
      toast(`Solo hay ${stock} disponibles`);
    }
    const {unitPrice,tier}=priceForQty(p,qty);
    const total=unitPrice*qty;

    box.querySelector(".promoTotal").textContent=`Lps. ${money(total)}`;
    const unitLabel=pluralize(unidad,qty).toUpperCase();
    box.querySelector(".promoLine").textContent=`${qty} ${unitLabel} x Lps. ${money(unitPrice)} c/u`;
    box.querySelector(".qtyVal").textContent=qty;
    box.querySelector(".qtyUnit").textContent=unitLabel;

    box.querySelectorAll(".tier").forEach(el=>{
      el.classList.remove("active");
      const c=Number(el.dataset.cant||0);
      const isDisabled=el.classList.contains("disabled");
      if(isDisabled) return;
      if(c===tier.cant) el.classList.add("active");
    });

    minus.classList.toggle("disabled",qty<=1);
    plus.classList.toggle("disabled",stock>0 && qty>=stock);

    const unitStr=pluralize(unidad,qty);
    const tierLabel=tier.cant>1?`Promo ${tier.cant}+`:`Precio normal`;
    const msg=`Hola SDC, quiero *${qty} ${unitStr}* de:\n*${p.nombre}*\n\n${tierLabel}\nPrecio unitario: Lps. ${money(unitPrice)}\nTotal: Lps. ${money(total)}\nStock disponible: ${stock}\n\nQuedo atento(a). Gracias.`;
    const link=`https://wa.me/${MY_PHONE}?text=${encodeURIComponent(msg)}`;

    const btn=box.querySelector(".promoBtn");
    btn.href=link;
    btn.innerHTML=`<i class="fa-brands fa-whatsapp"></i> PEDIR ${qty} ${unitStr.toUpperCase()} üöÄ`;
  }

  updatePromoUI();
}

/* ================== TESTIMONIOS ================== */
async function loadTestimonials(){
  try{
    const t = await fetchText(gvizUrlBySheet(TESTIMONIOS_SHEET));
    const {rows}=parseGviz(t);
    const clean=rows.map(r=>{
      const nombre=(r.nombre??"").toString().trim();
      const rol=(r.rol??r.tipo??"").toString().trim();
      const estrellas=Math.max(1,Math.min(5,Number(r.estrellas||5)));
      const comentario=(r.comentario??r.texto??r.opinion??"").toString().trim();
      const estado=norm(r.estado||"activo");
      return {nombre,rol,estrellas,comentario,estado};
    }).filter(x=>x.nombre && x.comentario && x.estado!=="inactivo");

    const list=clean.slice(0,8);
    if(!list.length) throw new Error("sin testimonios activos");
    renderTestimonials(list);
  }catch(e){
    console.warn("Testimonios no cargaron, fallback:",e);
    renderTestimonials([
      {nombre:"Cliente SDC",rol:"Cliente",estrellas:5,comentario:"Buena atenci√≥n y productos de calidad. Recomendado.",estado:"activo"},
      {nombre:"Gamer Comayagua",rol:"Gamer",estrellas:5,comentario:"Las promos por cantidad est√°n brutales. R√°pido y confiable.",estado:"activo"},
      {nombre:"Cliente Verificado",rol:"Cliente",estrellas:5,comentario:"El env√≠o lleg√≥ bien y el producto sellado. Excelente.",estado:"activo"},
    ]);
  }
}
function initials(name){
  const parts=(name||"").trim().split(/\s+/).slice(0,2);
  return parts.map(p=>p[0]?.toUpperCase()||"").join("")||"SD";
}
function renderTestimonials(list){
  const section=document.getElementById("testimonialsSection");
  const track=document.getElementById("testimonialsTrack");
  track.innerHTML="";
  list.forEach(t=>{
    const card=document.createElement("div");
    card.className="t-card";
    const stars=Array.from({length:t.estrellas}).map(()=>`<i class="fa-solid fa-star"></i>`).join("");
    card.innerHTML=`
      <div class="t-header">
        <div class="t-avatar">${escapeHtml(initials(t.nombre))}</div>
        <div class="t-info">
          <h4>${escapeHtml(t.nombre)}</h4>
          <span>${escapeHtml(t.rol||"Cliente")}</span>
        </div>
      </div>
      <div class="t-stars">${stars}</div>
      <p class="t-text">"${escapeHtml(t.comentario)}"</p>
    `;
    track.appendChild(card);
  });
  section.style.display="block";
}

/* ================== UI EVENTS ================== */
let __searchDeb;
document.getElementById("searchInput").addEventListener("input",()=>{
  pendingPid="";
  updateUrl();
  clearTimeout(__searchDeb);
  __searchDeb=setTimeout(()=>render(),120);
});

window.addEventListener("scroll",()=>{
  const f=document.getElementById("filtersWrapper");
  window.scrollY>50?f.classList.add("scrolled"):f.classList.remove("scrolled");

  const topBtn=document.getElementById("toTopBtn");
  if(topBtn){
    window.scrollY>420 ? topBtn.classList.add("show") : topBtn.classList.remove("show");
  }
});

function toggleFaq(element){element.parentElement.classList.toggle("open");}

const toggle=document.getElementById("themeToggle");
const st=loadState();
const sysDark=window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
applyTheme(st ? st.dark : sysDark);

toggle.onclick=()=>{
  applyTheme(!dark);
  saveState();
};
toggle.addEventListener("keydown",(e)=>{
  if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle.click(); }
});

/* ‚úÖ T√çTULO: IR AL INICIO REAL (SIN CATEGOR√çA SELECCIONADA) */
document.getElementById("goHome").onclick=()=>{
  currentCategory="";
  currentSub="";
  soloOfertasMode=false;
  pendingPid="";

  const si=document.getElementById("searchInput");
  if(si) si.value="";

  updateUrl();
  initCategoryBar();
  updateSubs();
  render();
  saveState();
  window.scrollTo({top:0,behavior:"smooth"});
};
document.getElementById("goHome").addEventListener("keydown",(e)=>{
  if(e.key==="Enter"||e.key===" "){ e.preventDefault(); document.getElementById("goHome").click(); }
});

/* ‚úÖ BOT√ìN SUBIR */
const topBtn=document.getElementById("toTopBtn");
if(topBtn){
  topBtn.onclick=()=>window.scrollTo({top:0,behavior:"smooth"});
}

document.getElementById("loadMapBtn").onclick=()=>{
  const shell=document.getElementById("mapShell");
  shell.innerHTML=`
    <iframe class="map-frame" style="width:100%;height:250px;border:0;"
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1933.2843779837946!2d-87.6289189153322!3d14.454458000000002!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f6585356521890d%3A0x5e9e0d326671793d!2sInkmortal%20Tattoo%20Comayagua!5e0!3m2!1ses!2shn!4v1709660000000!5m2!1ses!2shn"
      loading="lazy" referrerpolicy="no-referrer-when-downgrade" allowfullscreen=""></iframe>
  `;
};
function focusProductById(pid){
  const el=document.querySelector(`[data-pid="${CSS.escape(pid)}"]`);
  if(!el) return;
  el.classList.add("highlight");
  el.scrollIntoView({behavior:"smooth",block:"center"});
  setTimeout(()=>el.classList.remove("highlight"),1800);
}

/* ================== START ================== */
loadAll();
</script>
</body>
</html>