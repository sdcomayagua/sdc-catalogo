<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Soluciones Digitales Comayagua | Cat√°logo</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëæ</text></svg>">
  <meta name="description" content="Cat√°logo oficial de accesorios Gamer, PC y Streaming. Env√≠os a toda Honduras. Atenci√≥n directa por WhatsApp." />
  <meta property="og:title" content="Soluciones Digitales Comayagua | Cat√°logo Gamer 2026" />
  <meta property="og:description" content="Cat√°logo oficial de accesorios Gamer, PC y Streaming. Env√≠os a toda Honduras. ¬°Equ√≠pate con lo mejor!" />
  <meta property="og:image" content="https://raw.githubusercontent.com/sdcomayagua/sdc-catalogo/94d9f2b52faa08cccf5bfff9c50f2b8458ea4b04/PORTADA%20-%20SDC%20-%202026.png" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="theme-color" content="#0b1120" />
  <link rel="canonical" id="canonicalLink" href="" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    :root{
      --bg:#0b1120;--card-bg:#151e32;--primary:#38bdf8;--primary-text:#38bdf8;
      --accent:#2dd4bf;--accent-glow:rgba(45,212,191,.2);--text:#f8fafc;--text-muted:#94a3b8;
      --border:#1e293b;--shadow-card:0 4px 6px -1px rgba(0,0,0,.5);--chip-bg:#1e293b;--chip-text:#cbd5e1;
      --bg-image:radial-gradient(at top,#1e293b 0%,#0b1120 100%);--danger:#ef4444;
      --promo-color:#ff6b00;--promo-glow:rgba(255,107,0,.6);--promo-bg:rgba(255,107,0,.15)
    }
    [data-theme="light"]{
      --bg:#f8fafc;--card-bg:#fff;--primary:#0f172a;--primary-text:#000;--accent:#15803d;--accent-glow:rgba(0,0,0,0);
      --text:#1a1a1a;--text-muted:#64748b;--border:#e2e8f0;--shadow-card:0 4px 15px rgba(0,0,0,.05);
      --chip-bg:#fff;--chip-text:#4b5563;--bg-image:none;--promo-color:#ea580c;--promo-glow:rgba(234,88,12,.2);--promo-bg:#fff7ed
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{
      margin:0;font-family:'Outfit',sans-serif;background-color:var(--bg);background-image:var(--bg-image);background-attachment:fixed;
      color:var(--text);padding-bottom:95px;transition:background .3s,color .3s;-webkit-user-select:none;user-select:none
    }
    @media(max-width:768px){body{background-attachment:scroll}}
    @media (prefers-reduced-motion: reduce){
      *{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}
    }

    header{
      position:sticky;top:0;z-index:100;background:var(--card-bg);border-bottom:1px solid var(--border);padding:12px 16px;
      display:flex;align-items:center;justify-content:space-between;box-shadow:0 4px 20px rgba(0,0,0,.1)
    }
    .brand-link{text-decoration:none;color:inherit}
    .brand{display:flex;align-items:center;gap:10px;cursor:pointer}
    .brand img{height:40px;border-radius:6px;pointer-events:none}
    .brand h1{margin:0;font-size:16px;font-weight:900;color:var(--text);text-transform:uppercase;letter-spacing:1px}
    .brand h1 span{color:var(--primary)}
    .icon-btn{
      background:transparent;border:1px solid var(--border);color:var(--text);width:35px;height:35px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;cursor:pointer
    }
    .header-actions{display:flex;gap:10px;align-items:center}

    .hero-section{padding:40px 20px 20px;text-align:center;margin-bottom:10px;position:relative}
    .hero-title{font-size:28px;font-weight:900;margin:0 0 10px;line-height:1.1;color:var(--text);text-transform:uppercase;letter-spacing:-.5px}
    .hero-highlight{
      background:linear-gradient(-45deg,#38bdf8,#818cf8,#2dd4bf,#38bdf8);background-size:300%;
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:textShine 6s ease-in-out infinite
    }
    [data-theme="light"] .hero-highlight{
      background:linear-gradient(-45deg,#0284c7,#4f46e5,#059669,#0284c7);background-size:300%;
      -webkit-background-clip:text;-webkit-text-fill-color:transparent
    }
    @keyframes textShine{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .hero-desc{font-size:14px;color:var(--text-muted);margin:0 auto;line-height:1.5;max-width:90%;font-weight:400}

    .search-container{padding:0 16px;max-width:800px;margin:20px auto}
    .search-box{position:relative;display:flex;align-items:center}
    .search-box i{position:absolute;left:14px;color:var(--text-muted)}
    .search-box input{
      width:100%;padding:14px 44px 14px 45px;border-radius:16px;border:1px solid var(--border);background:var(--card-bg);
      color:var(--text);font-size:15px;outline:none;font-weight:600;box-shadow:0 4px 10px rgba(0,0,0,.05);user-select:text;-webkit-user-select:text
    }
    .search-box input:focus{border-color:var(--primary)}
    .clear-search{
      position:absolute;right:10px;width:30px;height:30px;border-radius:999px;border:1px solid var(--border);background:transparent;color:var(--text-muted);
      display:none;align-items:center;justify-content:center;cursor:pointer
    }
    .clear-search.show{display:flex}

    .trust-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:0 16px;max-width:800px;margin:25px auto}
    .trust-item{
      display:flex;align-items:center;justify-content:center;gap:8px;font-size:11px;font-weight:600;color:var(--text-muted);
      background:var(--card-bg);padding:10px;border-radius:12px;border:1px solid var(--border);box-shadow:0 2px 5px rgba(0,0,0,.02)
    }
    .trust-item i{color:var(--accent);font-size:14px}

    .filters-wrapper{position:sticky;top:60px;z-index:90;background:var(--bg);padding:12px 0 10px;border-bottom:1px solid transparent;transition:.3s}
    .filters-wrapper.scrolled{background:var(--card-bg);border-bottom:1px solid var(--border);box-shadow:0 4px 10px rgba(0,0,0,.1)}
    .category-bar,.sub-bar{display:flex;gap:10px;overflow-x:auto;padding:0 16px 8px;scrollbar-width:none}

    .chip{
      padding:8px 18px;border-radius:99px;background:var(--chip-bg);border:1px solid var(--border);color:var(--chip-text);
      font-size:13px;font-weight:700;white-space:nowrap;cursor:pointer;display:flex;align-items:center;gap:6px;text-transform:uppercase;transition:all .2s;outline:none
    }
    .chip:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(56,189,248,.15)}
    .chip.active{background:var(--primary);color:#fff;border-color:var(--primary);box-shadow:0 4px 12px rgba(0,0,0,.2);transform:translateY(-1px)}
    [data-theme="dark"] .chip.active{color:#000;font-weight:900}
    .chip.promo-active{
      background:linear-gradient(135deg,#f59e0b,#d97706)!important;border-color:#f59e0b!important;color:#fff!important;
      box-shadow:0 0 20px rgba(245,158,11,.8)!important;animation:pulse 1.5s infinite
    }
    .sub-bar .chip{padding:6px 14px;font-size:11px;border-radius:8px;background:transparent;border:1px solid var(--border)}
    .sub-bar .chip.active{background:var(--text);border-color:var(--text);color:var(--bg)}

    .result-meta{
      max-width:1200px;margin:10px auto 10px;padding:10px 16px;
      color:var(--text-muted);font-size:12px;font-weight:700;letter-spacing:.3px;display:none
    }
    .result-meta.show{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .result-left{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .tiny-pill{
      border:1px solid var(--border);background:rgba(255,255,255,.03);padding:6px 12px;border-radius:999px;
      color:var(--text-muted);font-size:11px;font-weight:800;text-transform:uppercase
    }
    [data-theme="light"] .tiny-pill{background:#f8fafc}

    .grid{display:grid;grid-template-columns:1fr;gap:16px;padding:10px 16px;max-width:1200px;margin:0 auto;min-height:200px}
    @media(min-width:768px){.grid{grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:24px}}

    .welcome-state{grid-column:1/-1;text-align:center;padding:40px 20px;color:var(--text-muted)}
    .welcome-icon{font-size:50px;margin-bottom:20px;color:var(--primary);opacity:.8;animation:bounce 2s infinite}
    .welcome-title{font-size:18px;font-weight:800;color:var(--text);margin-bottom:10px}
    .welcome-text{font-size:13px;max-width:320px;margin:0 auto;line-height:1.5}

    .card{
      background:var(--card-bg);border:1px solid var(--border);border-radius:16px;overflow:hidden;display:flex;flex-direction:column;position:relative;
      animation:fadeIn .4s ease-out forwards;box-shadow:var(--shadow-card);transition:.3s;
      content-visibility:auto;contain:content;contain-intrinsic-size:520px
    }
    .card.promo-mode{border:2px solid var(--promo-color)!important;box-shadow:0 0 25px var(--promo-glow)!important;transform:scale(1.02)}
    .card-img-container{
      width:100%;aspect-ratio:1/1;background-color:#fff;background-size:contain;background-position:center;background-repeat:no-repeat;
      padding:0;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border-bottom:1px solid var(--border)
    }
    .card.agotado .card-img-container{filter:grayscale(100%);opacity:.6}
    .card.agotado{opacity:.98;border-color:var(--danger)}

    .video-badge{
      position:absolute;bottom:8px;right:8px;z-index:20;display:flex;align-items:center;gap:5px;padding:5px 12px;border-radius:20px;
      font-size:10px;font-weight:800;color:#fff;text-decoration:none;backdrop-filter:blur(4px);box-shadow:0 2px 8px rgba(0,0,0,.3);
      transition:.2s;letter-spacing:.5px;text-transform:uppercase
    }
    .video-badge:hover{transform:scale(1.05)}
    .video-badge.tiktok{background:rgba(0,0,0,.9);border:1px solid rgba(255,255,255,.2)}
    .video-badge.youtube{background:rgba(220,38,38,.95);border:1px solid rgba(255,255,255,.2)}

    .ribbon{
      position:absolute;top:15px;left:-30px;width:105px;background:var(--danger);color:#fff;font-size:10px;font-weight:900;padding:4px 0;
      transform:rotate(-45deg);text-align:center;z-index:30;box-shadow:0 2px 5px rgba(0,0,0,.2);
      text-shadow:0 2px 6px rgba(0,0,0,.45)
    }
    .ribbon-promo{
      position:absolute;top:0;right:0;background:linear-gradient(135deg,#f59e0b,#ea580c);color:#fff;font-size:10px;font-weight:900;padding:6px 12px;
      border-bottom-left-radius:12px;z-index:30;box-shadow:-2px 2px 10px rgba(245,158,11,.5);letter-spacing:1px
    }
    .ribbon-new{
      position:absolute;top:0;left:0;background:linear-gradient(135deg,#38bdf8,#818cf8);color:#fff;font-size:10px;font-weight:900;padding:6px 12px;
      border-bottom-right-radius:12px;z-index:30;box-shadow:2px 2px 10px rgba(56,189,248,.35);letter-spacing:1px
    }

    .card-body{padding:16px;display:flex;flex-direction:column;gap:8px;flex-grow:1}
    .card h3{
      margin:0;font-size:16px;font-weight:900;line-height:1.3;text-transform:uppercase;letter-spacing:.5px;overflow:hidden;
      display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;height:42px;color:var(--text);text-shadow:0 1px 2px rgba(0,0,0,.3)
    }
    .desc{font-size:13.5px;font-weight:500;color:var(--text);opacity:.9;margin-bottom:6px;line-height:1.6;white-space:pre-line;padding-left:5px}

    .btn-gallery{
      display:flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:8px;margin-top:6px;background:transparent;border:1px dashed var(--border);
      border-radius:8px;color:var(--text-muted);font-size:11px;font-weight:700;text-decoration:none;text-transform:uppercase;letter-spacing:.5px;transition:.2s
    }
    .btn-gallery:hover{background:var(--card-bg);border-color:var(--primary);color:var(--primary)}

    .price-bar{display:flex;align-items:center;justify-content:center;gap:8px;background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:8px;padding:8px;margin-top:10px}
    [data-theme="light"] .price-bar{background:#f0fdf4;border-color:#dcfce7}
    .price-stack{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;line-height:1.2}
    .p-label-small{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-right:3px;opacity:.8}
    .old-price-row{color:var(--text-muted);line-height:1;margin-bottom:3px;white-space:nowrap;display:flex;align-items:center;justify-content:center}
    .old-val{text-decoration:line-through;opacity:.7;font-size:12px}
    .current-price-row{font-family:'Outfit',sans-serif;font-size:22px;font-weight:900;color:var(--accent);line-height:1;white-space:nowrap}
    .price-icon{color:var(--accent);font-size:16px;opacity:.8}
    .card.promo-mode .price-bar{background:var(--promo-bg);border-color:var(--promo-color)}
    .card.promo-mode .price-icon,.card.promo-mode .current-price-row{color:var(--promo-color);text-shadow:0 0 10px var(--promo-glow)}
    .card.agotado .price-bar{background:rgba(239,68,68,.1);border-color:var(--danger)}
    .card.agotado .price-icon,.card.agotado .current-price-row{color:var(--danger);text-shadow:none}
    [data-theme="light"] .card.agotado .price-bar{background:#fef2f2;border-color:#fca5a5}

    .bulk-box{
      margin-top:8px;border:1px solid var(--border);background:rgba(255,255,255,.03);border-radius:10px;padding:10px
    }
    .card.promo-mode .bulk-box{
      border-color:var(--promo-color);background:var(--promo-bg);box-shadow:0 0 15px var(--promo-glow)
    }
    .bulk-title{
      font-size:10px;font-weight:900;letter-spacing:.8px;text-transform:uppercase;color:var(--text-muted);
      margin-bottom:6px;display:flex;align-items:center;justify-content:center;gap:6px
    }
    .bulk-line{
      font-size:12px;font-weight:800;color:var(--text);
      display:flex;justify-content:space-between;gap:10px;padding:7px 8px;border-radius:10px
    }
    .bulk-line span:last-child{font-weight:900;color:var(--accent)}
    .card.promo-mode .bulk-line span:last-child{color:var(--promo-color);text-shadow:0 0 10px var(--promo-glow)}

    /* ‚úÖ selecci√≥n de promo por cantidad */
    .bulk-choice{cursor:pointer;transition:.15s;border:1px solid transparent}
    .bulk-choice:hover{transform:translateY(-1px)}
    .bulk-choice.selected{
      border:1px solid var(--promo-color);
      background:rgba(255,107,0,.08);
    }
    .bulk-hint{
      font-size:10px;font-weight:900;letter-spacing:.6px;text-transform:uppercase;
      color:var(--text-muted);margin-top:8px;text-align:center;opacity:.9
    }

    .btn-ws{
      background:var(--primary);color:#fff;border:none;padding:12px;border-radius:8px;font-weight:800;font-size:13px;cursor:pointer;text-decoration:none;
      display:flex;align-items:center;justify-content:center;gap:6px;text-transform:uppercase;transition:.2s
    }
    [data-theme="dark"] .btn-ws{color:#000}
    .agotado-hint{margin-top:2px;font-size:11px;font-weight:700;color:var(--text-muted);text-align:center;line-height:1.3}

    .testimonials-section{padding:30px 16px;margin-top:20px;background:rgba(255,255,255,.02);border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
    .sec-title{text-align:center;font-size:18px;font-weight:900;margin-bottom:20px;color:var(--text);text-transform:uppercase}
    .testimonials-track{display:flex;gap:15px;overflow-x:auto;padding-bottom:10px;scrollbar-width:none}
    .t-card{
      min-width:260px;max-width:260px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;padding:15px;
      display:flex;flex-direction:column;gap:8px;content-visibility:auto;contain:content;contain-intrinsic-size:240px
    }
    .t-header{display:flex;align-items:center;gap:10px;margin-bottom:5px}
    .t-avatar{width:35px;height:35px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px}
    [data-theme="dark"] .t-avatar{color:#000}
    .t-info h4{margin:0;font-size:13px;color:var(--text)}
    .t-info span{font-size:10px;color:var(--accent);font-weight:600;text-transform:uppercase}
    .t-stars{color:#fbbf24;font-size:12px;margin-bottom:0}
    .t-text{
      font-size:12px;color:var(--text-muted);line-height:1.4;font-style:italic;margin:0;
      text-align:justify;text-justify:inter-word;hyphens:auto
    }

    .location-section{padding:20px 16px;margin-top:10px;text-align:center}
    .map-frame{width:100%;height:250px;border:2px solid var(--border);border-radius:16px;margin-bottom:15px;filter:grayscale(20%) contrast(1.1)}
    .location-btns{display:flex;gap:10px;justify-content:center}
    .btn-loc{flex:1;padding:12px;border-radius:12px;font-weight:800;font-size:12px;text-decoration:none;display:flex;align-items:center;justify-content:center;gap:8px;text-transform:uppercase;transition:.2s}
    .btn-google{background:#4285F4;color:#fff;box-shadow:0 4px 10px rgba(66,133,244,.3)}
    .btn-waze{background:#33ccff;color:#fff;box-shadow:0 4px 10px rgba(51,204,255,.3)}

    .faq-section{padding:20px 16px;max-width:800px;margin:0 auto}
    .faq-item{background:var(--card-bg);border:1px solid var(--border);border-radius:12px;margin-bottom:10px;overflow:hidden}
    .faq-question{padding:15px;font-size:14px;font-weight:700;color:var(--text);display:flex;justify-content:space-between;align-items:center;cursor:pointer;transition:.2s}
    .faq-question:hover{background:rgba(255,255,255,.03)}
    .faq-answer{padding:0 15px 15px;font-size:13px;color:var(--text-muted);line-height:1.5;display:none;text-align:justify}
    .faq-item.open .faq-answer{display:block}
    .faq-item.open .faq-question i{transform:rotate(180deg)}

    footer{text-align:center;padding:30px 20px;color:var(--text-muted);font-size:12px;margin-top:20px;border-top:1px solid var(--border)}
    .social-bar{display:flex;justify-content:center;gap:15px;margin-bottom:20px}
    .social-btn{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;color:#fff;text-decoration:none;transition:.3s;box-shadow:0 4px 10px rgba(0,0,0,.3)}
    .sb-insta{background:linear-gradient(45deg,#f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%)}
    .sb-fb{background:#1877F2}
    .sb-tiktok{background:#000;border:1px solid #333}

    .float-ws{
      position:fixed;bottom:20px;right:20px;height:55px;width:55px;background:#25D366;border-radius:999px;
      display:flex;align-items:center;justify-content:center;color:#fff;font-size:28px;box-shadow:0 4px 15px rgba(0,0,0,.3);z-index:200;
      text-decoration:none;overflow:hidden;transition:.25s;gap:10px;padding:0 18px
    }
    .float-ws span{font-size:12px;font-weight:900;letter-spacing:.5px;text-transform:uppercase;white-space:nowrap;opacity:0;transform:translateX(8px);transition:.25s}
    .float-ws.expanded{width:160px;justify-content:flex-start}
    .float-ws.expanded span{opacity:1;transform:translateX(0)}

    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(245,158,11,.7)}70%{box-shadow:0 0 0 10px rgba(245,158,11,0)}100%{box-shadow:0 0 0 0 rgba(245,158,11,0)}}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}

    #loader{display:flex;flex-direction:column;align-items:center;justify-content:center;height:300px;color:var(--text)}
    .spinner{width:40px;height:40px;border:4px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite;margin-bottom:20px}
  </style>
</head>

<body>
<header>
  <a href="./" class="brand-link" id="homeLink" aria-label="Ir al inicio">
    <div class="brand">
      <img src="logo.png" alt="SDC" onerror="this.style.display='none'">
      <div>
        <h1>Soluciones <span>Digitales</span></h1>
        <small style="color:var(--text-muted);font-size:10px;letter-spacing:1px;font-weight:700;">COMAYAGUA</small>
      </div>
    </div>
  </a>

  <div class="header-actions">
    <div class="icon-btn" id="copyLinkBtn" aria-label="Copiar link para compartir" title="Copiar link"><i class="fa-solid fa-link"></i></div>
    <div class="icon-btn" id="themeToggle" aria-label="Cambiar tema"><i class="fa-solid fa-sun"></i></div>
  </div>
</header>

<div class="hero-section">
  <h2 class="hero-title">üéÆ <span class="hero-highlight">Accesorios Gamer</span> & Tecnolog√≠a</h2>
  <p class="hero-desc">En Comayagua. Atenci√≥n directa por WhatsApp.<br>Productos probados y ofertas reales.</p>
</div>

<div class="search-container">
  <div class="search-box">
    <i class="fa-solid fa-search"></i>
    <input id="searchInput" type="text" placeholder="Buscar producto..." aria-label="Buscar producto" />
    <button class="clear-search" id="clearSearchBtn" aria-label="Limpiar b√∫squeda"><i class="fa-solid fa-xmark"></i></button>
  </div>
</div>

<div class="trust-grid">
  <div class="trust-item"><i class="fa-solid fa-truck-fast"></i> Env√≠os a toda HN</div>
  <div class="trust-item"><i class="fa-solid fa-shield-halved"></i> Compra Segura</div>
  <div class="trust-item"><i class="fa-solid fa-headset"></i> Atenci√≥n Real</div>
  <div class="trust-item"><i class="fa-solid fa-star"></i> Clientes Felices</div>
</div>

<div class="filters-wrapper" id="filtersWrapper">
  <div class="category-bar" id="categoryBar">
    <div class="chip active">Cargando...</div>
  </div>
  <div class="sub-bar" id="subBar"></div>
</div>

<div class="result-meta" id="resultMeta">
  <div class="result-left" id="resultLeft"></div>
  <div id="resultRight"></div>
</div>

<div id="loader"><div class="spinner"></div><p>CARGANDO DATOS...</p></div>
<div class="grid" id="productGrid"></div>

<div class="testimonials-section">
  <h3 class="sec-title">‚≠ê Lo que dicen los Gamers</h3>
  <div class="testimonials-track" id="testimonialsTrack">
    <div class="t-card"><p class="t-text">Cargando testimonios...</p></div>
  </div>
</div>

<div class="location-section">
  <h3 class="sec-title">üìç Base de Operaciones</h3>
  <iframe class="map-frame" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1933.2843779837946!2d-87.6289189153322!3d14.454458000000002!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f6585356521890d%3A0x5e9e0d326671793d!2sInkmortal%20Tattoo%20Comayagua!5e0!3m2!1ses!2shn!4v1709660000000!5m2!1ses!2shn" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
  <div class="location-btns">
    <a href="https://www.google.com/maps/search/?api=1&query=Inkmortal+Tattoo+Comayagua" target="_blank" class="btn-loc btn-google" rel="noopener noreferrer">
      <i class="fa-solid fa-map-location-dot"></i> Google Maps
    </a>
    <a href="https://waze.com/ul?ll=14.454458,-87.6278246&navigate=yes" target="_blank" class="btn-loc btn-waze" rel="noopener noreferrer">
      <i class="fa-brands fa-waze"></i> Waze
    </a>
  </div>
</div>

<div class="faq-section">
  <h3 class="sec-title" style="margin-top:20px;">‚ùì Preguntas Frecuentes</h3>

  <div class="faq-item">
    <div class="faq-question" onclick="toggleFaq(this)">¬øHacen env√≠os a toda Honduras? <i class="fa-solid fa-chevron-down"></i></div>
    <div class="faq-answer">
      ¬°Claro que s√≠! üöö Realizamos env√≠os a todo el territorio nacional de Honduras a trav√©s de empresas de confianza como <b>C807, Forza y Cargo Expreso</b>. Si est√°s en Comayagua, ofrecemos servicio a domicilio o puedes retirar tu pedido personalmente en nuestra tienda f√≠sica.
    </div>
  </div>

  <div class="faq-item">
    <div class="faq-question" onclick="toggleFaq(this)">¬øD√≥nde est√°n ubicados? <i class="fa-solid fa-chevron-down"></i></div>
    <div class="faq-answer">
      Estamos dentro de <b>Inkmortal Tattoo Comayagua</b> üìç, en la Colonia Piedras Bonitas. Estamos contiguo a la Farmacia Regis y justo al lado de la Cl√≠nica de Licores. ¬°Te esperamos!
    </div>
  </div>

  <div class="faq-item">
    <div class="faq-question" onclick="toggleFaq(this)">¬øQu√© m√©todos de pago aceptan? <i class="fa-solid fa-chevron-down"></i></div>
    <div class="faq-answer">
      Aceptamos <b>Efectivo</b> y <b>Transferencia Bancaria</b> üí≥. Puedes transferir a nuestras cuentas en <b>BAC, Occidente, Ficohsa, Banpa√≠s y Atl√°ntida</b>. Tambi√©n aceptamos pagos v√≠a <b>PayPal y Tigo Money</b>.
    </div>
  </div>

  <div class="faq-item">
    <div class="faq-question" onclick="toggleFaq(this)">¬øTienen garant√≠a los productos? <i class="fa-solid fa-chevron-down"></i></div>
    <div class="faq-answer">
      ¬°Claro que s√≠! üõ°Ô∏è Cada producto es probado antes de ser enviado para garantizar su funcionamiento. Adem√°s, cuentan con garant√≠a por desperfectos de f√°brica. Compra con total seguridad.
    </div>
  </div>

  <div class="faq-item">
    <div class="faq-question" onclick="toggleFaq(this)">¬øC√≥mo puedo comprar? <i class="fa-solid fa-chevron-down"></i></div>
    <div class="faq-answer">
      ¬°Es muy sencillo! üõí Elige tu producto favorito, toca el bot√≥n <b>"PEDIR AHORA üöÄ"</b> y ser√°s redirigido a nuestro WhatsApp. All√≠ coordinaremos tu pago y env√≠o en minutos.
    </div>
  </div>
</div>

<footer>
  <div class="social-bar">
    <a href="https://www.facebook.com/sdcomayagua/" target="_blank" class="social-btn sb-fb" rel="noopener noreferrer" aria-label="Facebook"><i class="fa-brands fa-facebook-f"></i></a>
    <a href="https://www.instagram.com/sdcomayagua/" target="_blank" class="social-btn sb-insta" rel="noopener noreferrer" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
    <a href="https://www.tiktok.com/@gamer.comayagua" target="_blank" class="social-btn sb-tiktok" rel="noopener noreferrer" aria-label="TikTok"><i class="fa-brands fa-tiktok"></i></a>
  </div>
  <p>¬© 2026 Soluciones Digitales Comayagua<br><span style="font-size:10px;opacity:0.6;">Todos los derechos reservados.</span></p>
</footer>

<a class="float-ws" id="floatWs" href="https://wa.me/50432429490" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
  <i class="fa-brands fa-whatsapp"></i><span>Cotizar</span>
</a>

<script>
const SHEET_ID="1J-y47gPZuuyQOxaj9OJa4tMzR2IjfQVAzCR1i928dng";
const CONFIG_GID="1488858707";
const MY_PHONE="50432429490";
const BACKUP_SHEETS=['ofertas','gamer','pc','movil','streaming','cobertores','power'];
const TESTIMONIALS_SHEET="testimonios";

const NEW_DAYS=7;
const CACHE_PRODUCTS_KEY="sdc_products_cache_v4";
const CACHE_TESTIMONIALS_KEY="sdc_testimonials_cache_v2";

let products=[];
let testimonials=[];
let currentCategory="";
let currentSub="";
let ofertasOnly=false;

/* ‚úÖ selecci√≥n de promo por cantidad (se recuerda por producto) */
const promoPick={};

function setCanonical(){
  const el=document.getElementById("canonicalLink");
  if(!el) return;
  el.href=window.location.origin+window.location.pathname;
}
setCanonical();

function slugify(s){
  return String(s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
}
function norm(s){
  return String(s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();
}
function safeHttpUrl(u){
  const s=String(u||"").trim();
  if(!s) return "";
  if(s.startsWith("http://") || s.startsWith("https://")) return s;
  if(s.startsWith("www.")) return "https://"+s;
  return "";
}
function fixGithubRaw(url){
  let s=String(url||"");
  if(s && s.includes('github.com') && s.includes('/blob/')) s=s.replace('github.com','raw.githubusercontent.com').replace('/blob/','/');
  return s;
}
function readCache(key){
  try{ const raw=localStorage.getItem(key); if(!raw) return null; const obj=JSON.parse(raw); if(!obj || !obj.d) return null; return obj.d; }
  catch{ return null; }
}
function writeCache(key,data){
  try{ localStorage.setItem(key, JSON.stringify({t:Date.now(), d:data})); }catch{}
}
function hashStr(str){
  let h=2166136261;
  const s=String(str||"");
  for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=(h*16777619)>>>0; }
  return h.toString(36);
}

function parseDateAny(v){
  if(!v) return null;
  if(typeof v==="string"){
    const s=v.trim();
    const m=s.match(/^Date\((\d{4}),\s*(\d{1,2}),\s*(\d{1,2})/i);
    if(m) return new Date(Number(m[1]), Number(m[2]), Number(m[3]));
    const d1=new Date(s); if(!isNaN(d1)) return d1;
    const m2=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
    if(m2) return new Date(Number(m2[3]), Number(m2[2])-1, Number(m2[1]));
  }
  return null;
}
function daysBetween(a,b){
  const ms=24*60*60*1000;
  return Math.floor((a-b)/ms);
}
function isNewProduct(p){
  const d=parseDateAny(p.fecha || p.fecha_ingreso || p.nuevo_fecha);
  if(!d) return false;
  const diff=daysBetween(new Date(), d);
  return diff>=0 && diff<=NEW_DAYS;
}

/* ‚úÖ deep link: query + hash fallback */
function parseDeepLink(){
  const params=new URLSearchParams(window.location.search);
  let cat=params.get('cat')||"";
  let sub=params.get('sub')||"";
  let promo=params.get('promo')||"";
  if(cat || promo) return {cat,sub,promo};

  const h=window.location.hash||"";
  if(h.startsWith("#/")){
    const raw=h.slice(2);
    const partsQ=raw.split("?");
    const path=partsQ[0]||"";
    const qp=new URLSearchParams(partsQ[1]||"");
    const parts=path.split("/").filter(Boolean);
    return {cat:parts[0]||"",sub:parts[1]||"",promo:qp.get("promo")||""};
  }
  if(h.startsWith("#")){
    const hp=new URLSearchParams(h.slice(1));
    return {cat:hp.get("cat")||"",sub:hp.get("sub")||"",promo:hp.get("promo")||""};
  }
  return {cat:"",sub:"",promo:""};
}

function updateUrl(push=true){
  const url=new URL(window.location);
  const catSlug=currentCategory?slugify(currentCategory):"";
  const subSlug=currentSub?slugify(currentSub):"";

  if(catSlug) url.searchParams.set("cat",catSlug); else url.searchParams.delete("cat");
  if(subSlug) url.searchParams.set("sub",subSlug); else url.searchParams.delete("sub");
  if(ofertasOnly) url.searchParams.set("promo","1"); else url.searchParams.delete("promo");

  const hashPromo=ofertasOnly ? "?promo=1" : "";
  url.hash = (catSlug || subSlug) ? `#/${catSlug}${subSlug?`/${subSlug}`:""}${hashPromo}` : (ofertasOnly ? `#/${hashPromo}` : "");

  if(push) history.pushState({}, "", url);
  else history.replaceState({}, "", url);
}

async function copyCurrentLink(){
  const link=window.location.href;
  try{ await navigator.clipboard.writeText(link); flashToast("LINK COPIADO ‚úÖ"); }
  catch{ prompt("Copia este link:", link); }
}
function flashToast(msg){
  const t=document.createElement("div");
  t.textContent=msg;
  t.style.position="fixed";
  t.style.left="50%";
  t.style.bottom="95px";
  t.style.transform="translateX(-50%)";
  t.style.padding="10px 14px";
  t.style.borderRadius="14px";
  t.style.background="rgba(0,0,0,.75)";
  t.style.color="#fff";
  t.style.fontWeight="900";
  t.style.fontSize="12px";
  t.style.letterSpacing=".5px";
  t.style.zIndex="9999";
  t.style.border="1px solid rgba(255,255,255,.2)";
  document.body.appendChild(t);
  setTimeout(()=>{t.style.opacity="0";t.style.transition="opacity .25s"},1200);
  setTimeout(()=>{t.remove()},1600);
}
document.getElementById("copyLinkBtn").addEventListener("click",copyCurrentLink);

function toggleFaq(element){ element.parentElement.classList.toggle('open'); }

function getIconForCategory(catName){
  if(!catName) return 'üì¶';
  const name=catName.toLowerCase();
  if(name.includes('oferta')||name.includes('promo')||name.includes('mayorista')) return 'üî•';
  if(name.includes('gamer')||name.includes('juego')) return 'üéÆ';
  if(name.includes('celular')||name.includes('m√≥vil')||name.includes('phone')||name.includes('samsung')||name.includes('iphone')) return 'üì±';
  if(name.includes('pc')||name.includes('computadora')) return 'üñ•Ô∏è';
  if(name.includes('tv')||name.includes('stream')) return 'üì∫';
  if(name.includes('audio')) return 'üéß';
  if(name.includes('power')) return 'üîã';
  if(name.includes('reloj')) return '‚åö';
  return 'üì¶';
}

/* =======================
   ‚úÖ WhatsApp helpers (promo por cantidad)
======================= */
function pluralizeUnit(unit, qty){
  const u=String(unit||"par").trim();
  if(qty===1) return u;
  if(u.toLowerCase()==="par") return "pares";
  if(u.endsWith("s")) return u;
  return u+"s";
}
function buildWaText(baseMsg, productName, tier){
  if(!tier) return baseMsg;
  const qty=tier.qty;
  const price=tier.price;
  const unit=pluralizeUnit(tier.unit, qty);
  const total=(qty*price);
  return `${baseMsg}

‚úÖ Quiero aprovechar la promo de *${productName}*:
‚Ä¢ ${qty} ${unit} a Lps. ${price} c/u
‚Ä¢ Total: Lps. ${total}`;
}
function buildWaLink(phone, msg){
  return `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
}

/* =======================
   ‚úÖ TESTIMONIOS (sheet)
======================= */
function resolveAvatarColor(value){
  const v=String(value||"").trim().toLowerCase();
  if(v==="primary")return"var(--primary)";
  if(v==="accent")return"var(--accent)";
  if(v)return value;
  return"var(--primary)";
}
function makeInitials(name){
  const parts=String(name||"").trim().split(/\s+/).filter(Boolean);
  if(parts.length===0)return"SD";
  const a=parts[0][0]||"",b=parts[1]?(parts[1][0]||""):"";
  return(a+b).toUpperCase();
}
function renderTestimonials(){
  const track=document.getElementById("testimonialsTrack");
  if(!track) return;
  track.innerHTML="";
  if(!testimonials.length){
    track.innerHTML=`<div class="t-card"><p class="t-text">A√∫n no hay testimonios.</p></div>`;
    return;
  }
  testimonials.forEach((t,idx)=>{
    const card=document.createElement("div");
    card.className="t-card";
    const avatarColor=resolveAvatarColor(t.color)||(idx%2===0?"var(--primary)":"var(--accent)");
    const initials=t.iniciales?t.iniciales.toUpperCase():makeInitials(t.nombre);

    const header=document.createElement("div"); header.className="t-header";
    const avatar=document.createElement("div"); avatar.className="t-avatar"; avatar.style.background=avatarColor; avatar.textContent=initials;

    const info=document.createElement("div"); info.className="t-info";
    const h4=document.createElement("h4"); h4.textContent=t.nombre;
    const span=document.createElement("span"); span.textContent=t.rol;
    info.appendChild(h4); info.appendChild(span);

    header.appendChild(avatar); header.appendChild(info);

    const stars=document.createElement("div"); stars.className="t-stars";
    for(let i=0;i<t.estrellas;i++){ const star=document.createElement("i"); star.className="fa-solid fa-star"; stars.appendChild(star); }

    const text=document.createElement("p"); text.className="t-text"; text.textContent=`"${t.comentario}"`;

    card.appendChild(header);
    card.appendChild(stars);
    card.appendChild(text);
    track.appendChild(card);
  });
}
function fetchTestimonials(){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(TESTIMONIALS_SHEET)}`;
  fetch(url).then(r=>r.text()).then(t=>{
    const json=JSON.parse(t.substring(47,t.length-2));
    const cols=json.table.cols.map(c=>c&&c.label?c.label.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"col");

    testimonials=json.table.rows.map(r=>{
      let obj={};
      r.c.forEach((c,i)=>obj[cols[i]]=c?(c.v===null?"":c.v):"");
      return obj;
    }).filter(x=>x.nombre&&(x.comentario||x.texto));

    testimonials=testimonials.map(x=>({
      nombre:String(x.nombre||"").trim(),
      rol:String(x.rol||"Cliente").trim(),
      comentario:String(x.comentario||x.texto||"").trim(),
      estrellas:Math.max(1,Math.min(5,parseInt(x.estrellas||"5",10)||5)),
      iniciales:String(x.iniciales||"").trim(),
      color:String(x.color||"").trim(),
      orden:parseInt(x.orden||"9999",10)||9999
    })).sort((a,b)=>a.orden-b.orden);

    writeCache(CACHE_TESTIMONIALS_KEY, testimonials);
    renderTestimonials();
  }).catch(()=>{});
}

/* =======================
   ‚úÖ FETCH PRODUCTOS
======================= */
function fetchConfig(){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${CONFIG_GID}`;
  const timeoutPromise=new Promise((_,reject)=>setTimeout(()=>reject(new Error("Timeout")),7000));
  Promise.race([fetch(url),timeoutPromise]).then(r=>r.text()).then(t=>{
    const json=JSON.parse(t.substring(47,t.length-2));
    const sheetNames=json.table.rows.map(r=>r.c[0]?r.c[0].v:null).filter(name=>name&&name.toLowerCase()!=='sheet');
    const productSheets=sheetNames.filter(n=>slugify(n)!==slugify(TESTIMONIALS_SHEET));
    loadAllTabs(productSheets);
  }).catch(()=>{
    const productSheets=BACKUP_SHEETS.filter(n=>slugify(n)!==slugify(TESTIMONIALS_SHEET));
    loadAllTabs(productSheets);
  });
}
function fetchTab(sheetName){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
  return fetch(url).then(r=>r.text()).then(t=>{
    const json=JSON.parse(t.substring(47,t.length-2));
    const cols=json.table.cols.map(c=>c&&c.label?c.label.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"col");
    return json.table.rows.map(r=>{
      let obj={};
      r.c.forEach((c,i)=>obj[cols[i]]=c?(c.v===null?"":c.v):"");
      if(!obj.categoria) obj.categoria=sheetName;
      obj._sheet = sheetName;
      return obj;
    }).filter(p=>p.nombre);
  }).catch(()=>[]);
}
function loadAllTabs(sheetNames){
  Promise.all(sheetNames.map(name=>fetchTab(name))).then(results=>{
    products=results.flat();
    const loader=document.getElementById('loader');
    if(products.length===0){ loader.innerHTML="<p>No se encontraron productos.</p>"; return; }
    writeCache(CACHE_PRODUCTS_KEY, products);
    loader.style.display='none';
    initCategories();
    loadFromUrl();
  });
}

/* =======================
   ‚úÖ PROMOS POR CANTIDAD + CONTROL OFERTAS
======================= */
function truthy(v){
  const s=String(v||"").trim().toLowerCase();
  return s==="1"||s==="si"||s==="s√≠"||s==="true"||s==="x"||s==="yes";
}
function getBulkTiers(p){
  const unit=String(p.unidad||"par").trim() || "par";
  const q1=p.promo1_cant ?? p.promo1_cantidad ?? p.promo_1_cant ?? p.promo_1_cantidad ?? p.cant_1 ?? "";
  const a1=p.promo1_precio ?? p.promo_1_precio ?? p.precio_1 ?? "";
  const q2=p.promo2_cant ?? p.promo2_cantidad ?? p.promo_2_cant ?? p.promo_2_cantidad ?? p.cant_2 ?? "";
  const a2=p.promo2_precio ?? p.promo_2_precio ?? p.precio_2 ?? "";

  const tiers=[];
  const n1=parseInt(q1,10), n2=parseInt(q2,10);
  const p1=parseFloat(a1), p2=parseFloat(a2);

  if(Number.isFinite(n1) && n1>0 && Number.isFinite(p1)) tiers.push({qty:n1, price:p1, unit});
  if(Number.isFinite(n2) && n2>0 && Number.isFinite(p2)) tiers.push({qty:n2, price:p2, unit});

  return tiers;
}
function hasPromo(p, tiers){
  return String(p.precio_anterior||"").trim()!=="" || (tiers && tiers.length>0) || truthy(p.solo_ofertas);
}

function normalizeProduct(p){
  const cat=(p.categoria?String(p.categoria).trim():"Otros");
  const sub=String(p.subcategoria||"").trim();

  const stockRaw=String(p.stock??"").trim();
  const stockNum=Number(stockRaw);
  const hasStock=stockRaw!=="";
  const agotado=hasStock?(Number.isFinite(stockNum)&&stockNum<=0):false;

  const img=fixGithubRaw(safeHttpUrl(p.imagen) || p.imagen || "");
  const gal=safeHttpUrl(p.galeria);
  const tiktok=safeHttpUrl(p.tiktok);
  const youtube=safeHttpUrl(p.youtube);

  const orderVal=parseInt(p.orden||p.order||"999999",10);
  const ord=Number.isFinite(orderVal)?orderVal:999999;

  const nombre=String(p.nombre||"").trim();
  const desc=String(p.descripcion||p.descipcion||"").trim();

  const promoOnly=truthy(p.solo_ofertas);
  const tiers=getBulkTiers(p);
  const promo=hasPromo(p, tiers);
  const nuevo=isNewProduct(p);

  const keyBase = `${cat}|${sub}|${nombre}|${String(p.precio||"")}|${String(p.precio_anterior||"")}|${img}|${String(p._sheet||"")}`;
  const key = `${slugify(cat)}_${hashStr(keyBase)}`;

  return {...p,_cat:cat,_sub:sub,_agotado:agotado,_img:img,_gal:gal,_tiktok:tiktok,_youtube:youtube,_ord:ord,_nombre:nombre,_desc:desc,_promo:promo,_nuevo:nuevo,_promoOnly:promoOnly,_tiers:tiers,_key:key};
}

function sortProducts(list){
  return list.sort((a,b)=>{
    if(a._agotado!==b._agotado) return a._agotado?1:-1;
    if(a._promo!==b._promo) return a._promo?-1:1;
    if(a._ord!==b._ord) return a._ord-b._ord;
    return norm(a._nombre).localeCompare(norm(b._nombre));
  });
}

/* =======================
   ‚úÖ UI CHIPS
======================= */
function makeClickableChip(el){
  el.setAttribute('role','button');
  el.setAttribute('tabindex','0');
  el.onkeydown=(e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); el.click(); } };
  return el;
}
function clearActiveCategoryChips(){
  document.querySelectorAll('.category-bar .chip.cat-chip').forEach(b=>{ b.classList.remove('active'); b.classList.remove('promo-active'); });
}
function setActiveCategoryChip(btn){
  clearActiveCategoryChips();
  btn.classList.add('active');
}
function setOffersChipState(){
  const chip=document.getElementById("offersOnlyChip");
  if(!chip) return;
  chip.classList.toggle("active", ofertasOnly);
  chip.classList.toggle("promo-active", ofertasOnly);
}

/* ‚úÖ OCULTAR CATEGOR√çAS OFERTAS/MAYORISTA PARA NO DUPLICAR */
function isHiddenOffersCategory(catName){
  const s=String(catName||"").toLowerCase();
  return s.includes("oferta") || s.includes("mayorista") || s.includes("promo");
}

function initCategories(){
  const rawCats=products.map(p=>p.categoria?String(p.categoria).trim():"Otros");
  const uniqueCats=[...new Set(rawCats)];
  const cats=uniqueCats.filter(c=>!isHiddenOffersCategory(c));

  const bar=document.getElementById('categoryBar');
  bar.innerHTML="";

  const offersChip=document.createElement('div');
  offersChip.className='chip';
  offersChip.id="offersOnlyChip";
  offersChip.innerHTML=`üí• SOLO OFERTAS`;
  offersChip.onclick=()=>{
    ofertasOnly=!ofertasOnly;
    setOffersChipState();
    updateUrl(true);
    render();
  };
  makeClickableChip(offersChip);
  bar.appendChild(offersChip);

  cats.forEach((c)=>{
    const catName=String(c).trim();
    const btn=document.createElement('div');
    btn.className='chip cat-chip';
    btn.dataset.cat=catName;
    btn.dataset.slug=slugify(catName);
    btn.innerHTML=`${getIconForCategory(catName)} ${catName}`;
    btn.onclick=()=>{
      currentCategory=catName; currentSub="";
      setActiveCategoryChip(btn);
      updateSubs();
      updateUrl(true);
      render();
    };
    makeClickableChip(btn);
    bar.appendChild(btn);
  });

  setOffersChipState();
  updateSubs();
}

function updateSubs(){
  const bar=document.getElementById('subBar');
  bar.innerHTML="";
  if(!currentCategory){ bar.style.display='none'; return; }

  const currentCatProducts=products.map(normalizeProduct).filter(p=>p._cat===currentCategory && (!p._promoOnly));
  const subs=[...new Set(currentCatProducts.map(p=>p._sub).filter(Boolean))];

  if(subs.length===0){ bar.style.display='none'; return; }
  bar.style.display='flex';

  const allBtn=document.createElement('div');
  allBtn.className='chip active'; allBtn.textContent='Todo';
  allBtn.dataset.sub=""; allBtn.dataset.slug="todo";
  allBtn.onclick=()=>{ currentSub=""; updateUrl(true); render(); setActiveSub(allBtn); };
  makeClickableChip(allBtn);
  bar.appendChild(allBtn);

  subs.forEach(s=>{
    const subName=String(s).trim();
    const btn=document.createElement('div');
    btn.className='chip'; btn.textContent=subName;
    btn.dataset.sub=subName; btn.dataset.slug=slugify(subName);
    btn.onclick=()=>{ currentSub=subName; updateUrl(true); render(); setActiveSub(btn); };
    makeClickableChip(btn);
    bar.appendChild(btn);
  });
}
function setActiveSub(btn){
  document.querySelectorAll('.sub-bar .chip').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}

/* =======================
   ‚úÖ HOME
======================= */
function goHome(pushUrl=true){
  currentCategory=""; currentSub="";
  clearActiveCategoryChips();
  const subBar=document.getElementById('subBar');
  subBar.innerHTML=""; subBar.style.display='none';
  updateUrl(pushUrl);
  render();
  window.scrollTo({top:0,behavior:'smooth'});
}
document.getElementById('homeLink').addEventListener('click',(e)=>{ e.preventDefault(); goHome(true); });

/* =======================
   ‚úÖ URL -> UI
======================= */
function loadFromUrl(){
  const {cat:catSlug, sub:subSlug, promo}=parseDeepLink();
  ofertasOnly = String(promo||"").trim()==="1";
  setOffersChipState();

  if(!catSlug){
    currentCategory=""; currentSub="";
    clearActiveCategoryChips();
    const subBar=document.getElementById('subBar');
    subBar.innerHTML=""; subBar.style.display='none';
    updateUrl(false);
    render();
    return;
  }

  const catChip=[...document.querySelectorAll('.category-bar .chip.cat-chip')]
    .find(chip=>chip.dataset && chip.dataset.slug===catSlug);

  if(!catChip){
    currentCategory=""; currentSub="";
    updateUrl(false);
    render();
    return;
  }

  currentCategory=catChip.dataset.cat||""; currentSub="";
  setActiveCategoryChip(catChip);
  updateSubs();

  if(subSlug){
    const subChip=[...document.querySelectorAll('.sub-bar .chip')]
      .find(chip=>chip.dataset && chip.dataset.slug===subSlug);
    if(subChip && subChip.dataset.sub){ currentSub=subChip.dataset.sub; setActiveSub(subChip); }
    else { const todo=document.querySelector('.sub-bar .chip[data-slug="todo"]'); if(todo) setActiveSub(todo); }
  } else {
    const todo=document.querySelector('.sub-bar .chip[data-slug="todo"]'); if(todo) setActiveSub(todo);
  }

  updateUrl(false);
  render();
}
window.addEventListener('popstate',()=>{ if(products.length) loadFromUrl(); });

/* =======================
   ‚úÖ BUSCADOR
======================= */
const searchInput=document.getElementById('searchInput');
const clearBtn=document.getElementById('clearSearchBtn');
function setClearBtn(){ clearBtn.classList.toggle("show", searchInput.value.trim().length>0); }
clearBtn.addEventListener("click",()=>{
  searchInput.value="";
  setClearBtn();
  updateUrl(true);
  render();
  searchInput.focus();
});
searchInput.addEventListener("input",()=>{ setClearBtn(); });

/* =======================
   ‚úÖ META
======================= */
function setResultMeta(count, modeLabel){
  const meta=document.getElementById("resultMeta");
  const left=document.getElementById("resultLeft");
  const right=document.getElementById("resultRight");
  if(!meta || !left || !right) return;

  if(count===null){ meta.classList.remove("show"); return; }
  meta.classList.add("show");
  left.innerHTML=""; right.textContent="";

  const a=document.createElement("div");
  a.className="tiny-pill";
  a.textContent=`Mostrando: ${count}`;
  left.appendChild(a);

  if(modeLabel){
    const b=document.createElement("div");
    b.className="tiny-pill";
    b.textContent=modeLabel;
    left.appendChild(b);
  }

  if(ofertasOnly){
    const c=document.createElement("div");
    c.className="tiny-pill";
    c.textContent="Solo Ofertas ‚úÖ";
    left.appendChild(c);
  }
}

/* =======================
   ‚úÖ RENDER
======================= */
function render(){
  const grid=document.getElementById('productGrid');
  grid.innerHTML="";

  const qRaw=searchInput.value;
  const q=norm(qRaw);
  const searching=q.length>0;

  if(currentCategory==="" && !searching){
    setResultMeta(null,null);
    grid.innerHTML=`
      <div class="welcome-state">
        <div class="welcome-icon"><i class="fa-solid fa-hand-pointer"></i></div>
        <h3 class="welcome-title">¬°Empieza tu b√∫squeda!</h3>
        <p class="welcome-text">Selecciona una categor√≠a arriba (Gamer, PC, M√≥vil...) o escribe en el buscador para buscar en todo el cat√°logo.</p>
      </div>
    `;
    return;
  }

  let list=products.map(normalizeProduct);

  if(!ofertasOnly){
    list=list.filter(p=>!p._promoOnly);
  }
  if(ofertasOnly){
    list=list.filter(p=>p._promo);
  }
  if(currentCategory){
    list=list.filter(p=>p._cat===currentCategory && (!currentSub || p._sub===currentSub));
  }
  if(searching){
    list=list.filter(p=>{
      const n=norm(p._nombre);
      const d=norm(p._desc);
      const c=norm(p._cat);
      const s=norm(p._sub);
      return n.includes(q) || d.includes(q) || c.includes(q) || s.includes(q);
    });
  }

  list=sortProducts(list);

  const modeLabel = searching ? "B√∫squeda" : (currentCategory ? `Categor√≠a: ${currentCategory}` : "Cat√°logo");
  setResultMeta(list.length, modeLabel);

  if(list.length===0){
    grid.innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--text-muted)"><i class="fa-solid fa-ghost" style="font-size:40px;margin-bottom:10px;"></i><p>NO HAY RESULTADOS</p></div>`;
    return;
  }

  list.forEach(p=>{
    const isPromoMode=(p._promo && !p._agotado);

    let ribbonHTML="";
    if(p._agotado) ribbonHTML+=`<div class="ribbon">AGOTADO</div>`;
    else if(isPromoMode) ribbonHTML+=`<div class="ribbon-promo">üî• HOT SALE</div>`;
    if(!p._agotado && p._nuevo) ribbonHTML+=`<div class="ribbon-new">üÜï NUEVO</div>`;

    const descText=String(p._desc||"").replace(/(\r\n|\n|\r)/gm," ").replace(/([‚ñ∫‚Ä¢\-‚òÖ])/g,'\n$1').trim();

    let priceHTMLContent="";
    if(String(p.precio_anterior||"").trim()!==""){
      priceHTMLContent=`<div class="price-stack"><div class="old-price-row"><span class="p-label-small">Antes:</span> <span class="old-val">Lps. ${p.precio_anterior}</span></div><div class="current-price-row">Lps. ${p.precio||'0'}</div></div>`;
    } else {
      priceHTMLContent=`<div class="price-stack"><div class="current-price-row">Lps. ${p.precio||'0'}</div></div>`;
    }
    const priceHTML=`<div class="price-bar"><i class="fa-solid fa-tag price-icon"></i>${priceHTMLContent}</div>`;

    /* ‚úÖ promo por cantidad (sin seleccionar por defecto) */
    let bulkHTML="";
    if(p._tiers && p._tiers.length && !p._agotado){
      const tiers=[...p._tiers].sort((a,b)=>a.qty-b.qty);
      const picked=promoPick[p._key] || null;

      const lines = tiers.map(t=>{
        const unitLabel=pluralizeUnit(t.unit, t.qty);
        const isSel = picked && (t.qty===picked.qty) && (t.price===picked.price);
        return `
          <div class="bulk-line bulk-choice ${isSel?'selected':''}" data-key="${p._key}" data-qty="${t.qty}" data-price="${t.price}" data-unit="${t.unit||'par'}">
            <span>${t.qty} ${unitLabel}</span>
            <span>Lps. ${t.price} c/u</span>
          </div>
        `;
      }).join("");

      bulkHTML=`
        <div class="bulk-box">
          <div class="bulk-title"><i class="fa-solid fa-bolt"></i> Promo por cantidad</div>
          ${lines}
          <div class="bulk-hint">Toca una opci√≥n (3 o 5) para que WhatsApp diga la promo exacta ‚úÖ</div>
        </div>
      `;
    }

    let videoBadge="";
    if(p._tiktok) videoBadge=`<a href="${p._tiktok}" target="_blank" class="video-badge tiktok" rel="noopener noreferrer"><i class="fa-brands fa-tiktok"></i> VER VIDEO</a>`;
    else if(p._youtube) videoBadge=`<a href="${p._youtube}" target="_blank" class="video-badge youtube" rel="noopener noreferrer"><i class="fa-brands fa-youtube"></i> VER VIDEO</a>`;

    let galleryBtn="";
    if(p._gal) galleryBtn=`<a href="${p._gal}" target="_blank" class="btn-gallery" rel="noopener noreferrer"><i class="fa-regular fa-images"></i> Ver M√°s Fotos</a>`;

    /* ‚úÖ WhatsApp base + selected tier */
    let btnText="PEDIR AHORA üöÄ";
    const defaultBase=`Hola SDC, me interesa: *${p._nombre}*`;
    let waBase = defaultBase;

    /* Si NO hay promo por cantidad, s√≠ usamos tu columna whatsapp si existe */
    const hasTiers = (p._tiers && p._tiers.length);
    if(!hasTiers && p.whatsapp && String(p.whatsapp).length>5){
      waBase = String(p.whatsapp);
    }

    let waMsg = waBase;

    const pickedTier = promoPick[p._key] || null;
    if(pickedTier && !p._agotado){
      waMsg = buildWaText(waBase, p._nombre, pickedTier);
      btnText = `PEDIR ${pickedTier.qty} ${pluralizeUnit(pickedTier.unit, pickedTier.qty).toUpperCase()} üöÄ`;
    }

    if(p._agotado){
      btnText="CONSULTAR";
      waMsg = `Hola SDC, el producto *${p._nombre}* est√° AGOTADO. Av√≠senme cuando llegue.`;
    }

    const waLink = buildWaLink(MY_PHONE, waMsg);

    const card=document.createElement('div');
    card.className=`card ${p._agotado?'agotado':''} ${isPromoMode?'promo-mode':''}`;

    const agotadoHint = p._agotado ? `<div class="agotado-hint">Escr√≠benos y te avisamos cuando regrese.</div>` : "";
    const imgStyle = p._img ? `background-image:url('${p._img}');` : `background-image:none;`;

    card.innerHTML=`
      ${ribbonHTML}
      <div class="card-img-container" style="${imgStyle}">
        ${videoBadge}
      </div>
      <div class="card-body">
        <h3>${p._nombre}</h3>
        <div class="desc">${descText}</div>
        ${galleryBtn}
        ${priceHTML}
        ${bulkHTML}
        <a href="${waLink}" target="_blank" rel="noopener noreferrer"
           class="btn-ws"
           data-key="${p._key}"
           data-name="${p._nombre}"
           data-base="${waBase.replace(/"/g,'&quot;')}"
           style="${p._agotado?'background:#333;color:#aaa;box-shadow:none;':''}">
          <i class="fa-brands fa-whatsapp"></i> ${btnText}
        </a>
        ${agotadoHint}
      </div>
    `;
    grid.appendChild(card);
  });
}

/* ‚úÖ debounce search */
let searchTimer=null;
searchInput.addEventListener('input',()=>{
  clearTimeout(searchTimer);
  searchTimer=setTimeout(()=>{ updateUrl(false); render(); },120);
});

/* ‚úÖ sticky scroll + ws */
window.addEventListener('scroll',()=>{
  const f=document.getElementById('filtersWrapper');
  window.scrollY>50?f.classList.add('scrolled'):f.classList.remove('scrolled');

  const ws=document.getElementById("floatWs");
  if(!ws) return;
  if(window.scrollY>500) ws.classList.add("expanded");
  else ws.classList.remove("expanded");
},{passive:true});

/* ‚úÖ theme saved + system */
const toggle=document.getElementById('themeToggle');
function applyTheme(theme){
  document.documentElement.setAttribute('data-theme',theme);
  toggle.innerHTML=(theme==='dark')?'<i class="fa-solid fa-moon"></i>':'<i class="fa-solid fa-sun"></i>';
}
const savedTheme=localStorage.getItem('theme');
const systemPrefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;
applyTheme(savedTheme||(systemPrefersDark?'dark':'light'));
toggle.onclick=()=>{
  const current=document.documentElement.getAttribute('data-theme')||'light';
  const next=current==='dark'?'light':'dark';
  localStorage.setItem('theme',next);
  applyTheme(next);
};

/* ‚úÖ click en promo por cantidad -> actualiza WhatsApp */
document.getElementById("productGrid").addEventListener("click",(e)=>{
  const choice=e.target.closest(".bulk-choice");
  if(!choice) return;

  const card=choice.closest(".card");
  if(!card || card.classList.contains("agotado")) return;

  const key=choice.dataset.key;
  const qty=parseInt(choice.dataset.qty,10);
  const price=parseFloat(choice.dataset.price);
  const unit=choice.dataset.unit || "par";

  promoPick[key]={qty, price, unit};

  card.querySelectorAll(".bulk-choice").forEach(x=>x.classList.remove("selected"));
  choice.classList.add("selected");

  const btn=card.querySelector(".btn-ws");
  if(!btn) return;

  const productName = btn.dataset.name || "Producto";
  const baseRaw = btn.dataset.base ? btn.dataset.base.replace(/&quot;/g,'"') : `Hola SDC, me interesa: *${productName}*`;
  const msg = buildWaText(baseRaw, productName, promoPick[key]);

  btn.href = buildWaLink(MY_PHONE, msg);
  btn.innerHTML = `<i class="fa-brands fa-whatsapp"></i> PEDIR ${qty} ${pluralizeUnit(unit, qty).toUpperCase()} üöÄ`;
  flashToast(`Promo seleccionada: ${qty} ${pluralizeUnit(unit, qty)} ‚úÖ`);
});

/* ‚úÖ boot cache */
function bootFromCache(){
  const cachedP=readCache(CACHE_PRODUCTS_KEY);
  if(Array.isArray(cachedP) && cachedP.length){
    products=cachedP;
    const loader=document.getElementById('loader');
    loader.style.display='none';
    initCategories();
    loadFromUrl();
  }
  const cachedT=readCache(CACHE_TESTIMONIALS_KEY);
  if(Array.isArray(cachedT) && cachedT.length){
    testimonials=cachedT;
    renderTestimonials();
  }
}

bootFromCache();
fetchConfig();
fetchTestimonials();
setClearBtn();
render();
</script>
</body>
</html>
